!function e(n,r,t){function o(i,u){if(!r[i]){if(!n[i]){var c="function"==typeof require&&require;if(!u&&c)return c(i,!0);if(s)return s(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var d=r[i]={exports:{}};n[i][0].call(d.exports,function(e){var r=n[i][1][e];return o(r?r:e)},d,d.exports,e,n,r,t)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(e,n,r){"use strict";function t(e){if(Array.isArray(e)){for(var n=0,r=Array(e.length);n<e.length;n++)r[n]=e[n];return r}return Array.from(e)}var o=e("./standardize.js"),s=e("./websocket/index.js"),i=e("./options.js"),u=e("./request.cache.js"),c=e("./util.js"),a=[],d=void 0,f=void 0,l=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),t=1;t<n;t++)r[t-1]=arguments[t];for(var o=0;o<r.length;o++)c.isFunction(r[o].extendRapportConstructor)&&r[o].extendRapportConstructor(e)},p=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),t=1;t<n;t++)r[t-1]=arguments[t];for(var o=0;o<r.length;o++)c.isFunction(r[o].extendRapportInstance)&&r[o].extendRapportInstance(e)},x=function(e,n,r,t){for(var o=arguments.length,s=Array(o>4?o-4:0),i=4;i<o;i++)s[i-4]=arguments[i];for(var u=0;u<s.length;u++)c.isFunction(s[u].extendWebsocket)&&s[u].extendWebsocket(e,n,r,t)},g=function(e,n){var r={plugins:[].concat(a),options:i(n,d),Websocket:e||f,use:function(e){return r.plugins.push(e),p(r,e),r},websocket:function(e){return r.Websocket=e,r},configure:function(e){return r.options=i(e,r.options),r},create:function(e,n){if(!r.Websocket)throw new Error("A websocket implementation must be supplied to create Rapport websockets");var t=i(n,r.options);return r.wrap(new r.Websocket(e,t.protocols,t.connection),t)},wrap:function(e,n){var c=i(n,r.options),a=u(),d=o(e),f=s(d,a,c);return x.apply(void 0,[f,d,a,c].concat(t(r.plugins))),f.onMessage(function(e){}),f.onClose(function(e,n){}),f}};return p.apply(void 0,[r].concat(t(r.plugins))),r},v=g;v.use=function(e){return a.push(e),l(v,e),v},v.configure=function(e){return d=i(e,d),v},v.websocket=function(e){return f=e,v},v.create=function(e,n){return g(f,n).create(e)},v.wrap=function(e,n){return g(f,n).wrap(e)},"undefined"!=typeof window&&(window.Rapport=v),"undefined"!=typeof n&&(n.exports=v)},{"./options.js":2,"./request.cache.js":3,"./standardize.js":4,"./util.js":5,"./websocket/index.js":7}],2:[function(e,n,r){"use strict";var t=e("./util.js"),o={stringify:function(e){return t.isString(e)?e:e instanceof Error?JSON.stringify({name:e.name,message:e.message,stack:e.stack}):JSON.stringify(e)},parse:function(e){return t.isString(e)?JSON.parse(e):e},Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Date.now(),r=(n+16*Math.random())%16|0;return("x"===e?r:3&r|8).toString(16)})}};n.exports=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var t={},s=[].concat(n,[o]),i=0;i<s.length;i++)for(var u in s[i])s[i].hasOwnProperty(u)&&!t[u]&&(t[u]=s[i][u]);return t}},{"./util.js":5}],3:[function(e,n,r){"use strict";n.exports=function(){var e={requests:{},addCallback:function(n,r){e.requests[n]={cb:r}},addPromise:function(n,r,t){e.requests[n]={resolve:r,reject:t}},resolve:function(n,r){e.requests[n]&&(e.requests[n].cb?e.requests[n].cb(r):e.requests[n].resolve(r),delete e.requests[n])},reject:function(n,r){e.requests[n]&&(e.requests[n].cb?e.requests[n].cb(null,r):e.requests[n].reject(r),delete e.requests[n])},rejectAll:function(n){for(var r in e.requests)e.requests.hasOwnProperty(r)&&e.reject(r,n)}};return e}},{}],4:[function(e,n,r){"use strict";var t=function(e){return{onOpen:function(n){e.onopen=n},onClose:function(n){e.onclose=n},onError:function(n){e.onerror=n},onMessage:function(n){e.onmessage=function(e){n(e.data)}},send:e.send.bind(e),close:e.close.bind(e)}},o=function(e){function n(n,r){e.removeAllListeners(n),e.on(n,r)}return{onOpen:n.bind(null,"open"),onClose:n.bind(null,"close"),onError:n.bind(null,"error"),onMessage:n.bind(null,"message"),send:e.send.bind(e),close:e.close.bind(e)}};n.exports=function(e){return e.on?o(e):t(e)}},{}],5:[function(e,n,r){"use strict";var t={isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e}};n.exports=t},{}],6:[function(e,n,r){"use strict";n.exports=function(e,n,r){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Socket was closed",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3;n.rejectAll(new Error("Websocket was closed: with code "+o+" and message "+t)),e.close(o,r.stringify(t))}},{}],7:[function(e,n,r){"use strict";n.exports=function(n,r,t){var o={},s={send:e("./send.js"),close:e("./close.js"),request:e("./request.js"),respond:e("./respond.js"),respondWithError:e("./respond.with.error.js"),onOpen:n.onOpen,onError:n.onError,onMessage:e("./on.message.js"),onClose:e("./on.close.js")};return o.send=s.send.bind(null,n,t),o.close=s.close.bind(null,n,r,t),o.request=s.request.bind(null,o,r,t),o.respond=s.respond.bind(null,o,t),o.respondWithError=s.respondWithError.bind(null,o,t),o.onOpen=s.onOpen,o.onError=s.onError,o.onMessage=s.onMessage.bind(null,n,o,r,t),o.onClose=s.onClose.bind(null,n,r,t),o._functions=s,o}},{"./close.js":6,"./on.close.js":8,"./on.message.js":9,"./request.js":10,"./respond.js":11,"./respond.with.error.js":12,"./send.js":13}],8:[function(e,n,r){"use strict";n.exports=function(e,n,r,t){e.onClose(function(e,o){var s=void 0;try{s=r.parse(o)}catch(e){s=o}n.rejectAll(new Error("Websocket was closed: with code "+e+" and message "+r.stringify(s))),t(s,e)})}},{}],9:[function(e,n,r){"use strict";var t=function e(n,r,t,o,s){n.onMessage(function(n){var i=void 0;try{i=o.parse(n)}catch(e){return void r.send(e)}i.responseId?e.handleResponse(t,i.responseId,i.body,i.error):i.requestId?e.handleRequest(r,i.requestId,i.body,s):e.handleMessage(r,i,s)})};t.handleResponse=function(e,n,r,t){r?e.resolve(n,r):t?e.reject(n,t):e.reject(n,new Error("Got a response object without a response or error property"))},t.handleRequest=function(e,n,r,t){var o={id:n,isRequest:!0,body:r},s={sent:!1,respond:function(r){s.sent=!0,e.respond(n,r)},respondWithError:function(r){s.sent=!0,e.respondWithError(n,r)},send:e.send};t(o,s)},t.handleMessage=function(e,n,r){var t={isRequest:!1,body:n};r(t,e)},n.exports=t},{}],10:[function(e,n,r){"use strict";n.exports=function(e,n,r,t,o,s){var i={requestId:r.generateRequestId(),body:t};if(o&&setTimeout(function(){n.reject(i.requestId,new Error("Timed out after "+o+" ms"))},o),!s){if(r.Promise)return new r.Promise(function(r,t){n.addPromise(i.requestId,r,t),e.send(i)});throw new Error("Can't make a request without a Promise implementation or callback")}n.addCallback(i.requestId,s),e.send(i)}},{}],11:[function(e,n,r){"use strict";n.exports=function(e,n,r,t){e.send({responseId:r,body:t})}},{}],12:[function(e,n,r){"use strict";n.exports=function(e,n,r,t){e.send({responseId:r,error:t})}},{}],13:[function(e,n,r){"use strict";n.exports=function(e,n,r){e.send(n.stringify(r))}},{}]},{},[1]);
