!function e(t,n,r){function o(i,u){if(!n[i]){if(!t[i]){var a="function"==typeof require&&require;if(!u&&a)return a(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[i]={exports:{}};t[i][0].call(f.exports,function(e){var n=t[i][1][e];return o(n?n:e)},f,f.exports,e,t,n,r)}return n[i].exports}for(var s="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){"use strict";var r=e("./standardize.js"),o=e("./websocket/index.js"),s=e("./options.js"),i=e("./util.js"),u=function(t,n){s.initialize(n);var u={Router:e("./router.js"),create:function(e,n){var r=void 0;return n&&i.isObject(n)&&(r=n.ws,delete n.ws),u.wrap(new t(e,r),n)},wrap:function(e,t){if(t&&t.router&&!i.isObject(t.router)&&!i.isFunction(t.router.handle))throw new Error("Please supply a rapport router as the router property");return o(r(e),t.router)}};return u};"undefined"!=typeof window&&(window.Rapport=u),"undefined"!=typeof t&&(t.exports=u)},{"./options.js":2,"./router.js":4,"./standardize.js":5,"./util.js":6,"./websocket/index.js":11}],2:[function(e,t,n){"use strict";var r={initialize:function(e){e&&(e.stringify&&(r.stringify=e.stringify),e.parse&&(r.parse=e.parse),e.Promise&&(r.Promise=e.Promise),e.generateRequestId&&(r.generateRequestId=e.generateRequestId))},stringify:JSON.stringify,parse:JSON.parse,Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Date.now(),n=(t+16*Math.random())%16|0;return("x"===e?n:3&n|8).toString(16)})}};t.exports=r},{}],3:[function(e,t,n){"use strict";var r=e("./util.js"),o={},s={addCallback:function(e,t){o[e]={cb:t}},addPromise:function(e,t,n){o[e]={resolve:t,reject:n}},resolve:function(e,t){o[e]&&(o[e].cb?o[e].cb(t):o[e].resolve(t),delete o[e])},reject:function(e,t){o[e]&&(o[e].cb?o[e].cb(null,t):o[e].reject(t),delete o[e])},rejectAll:function(e,t){Object.keys(o).forEach(function(n){s.reject(n,new Error("Websocket has been closed: "+e+" - "+r.stringify(t)))})}};t.exports=s},{"./util.js":6}],4:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var o=e("./util.js"),s=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var s=[];if(!n||0===n.length)throw new Error("Please supply at least one handler for the route");for(var i=0;i<n.length;i++){var u={verb:e};if(!o.isFunction(n[i]))throw new Error("Please supply only handler methods to rapport route methods");u.handle=n[i],s.push(u)}return s},i=function(e,t,n,r,s){var i=!1,u=function u(){if(n.length>0){var a=n.shift();if("all"===a.verb||a.verb===e.verb)try{i=!0;var c=a.handle(e,t,u);c&&o.isFunction(c.then)&&c.then(u,r)}catch(e){r(e)}}else s(i)};u()},u=function(e){var t=e;return o.endsWith(t,"/")&&(t=t.substring(0,t.length-1)),o.startsWith(t,"/")&&(t=t.substring(1,t.length)),t},a=function(e){for(var t=[],n=[],r=e.split("/"),s=0;s<r.length;s++)o.startsWith(r[s],":")?(t.push("([A-Za-z0-9_-]+)"),n.push(r[s].substr(1))):t.push(o.regexEscape(r[s]));return{paramNames:n,regex:new RegExp(t.join(o.regexEscape("/"))+"$")}},c=function(e,t){var n=u(e),r=u(t);return 0!==n.length&&0!==r.length?n+"/"+r:0===n.length?r:n},f=function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];for(var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=0;s<t.length;s++)t[s]&&0!==t[s].length&&o.push.apply(o,r(t[s]));return o},l=function(){var e={},t={},n={},r=[],l=function(t){for(var r in e)e.hasOwnProperty(r)&&f(e[r],t);for(var o in n)n.hasOwnProperty(o)&&f(n[o],t)},d=function(r,o){var s=u(r);s.indexOf(":")<0?(e[s]||(e[s]=[]),f(e[s],o)):(n[s]||(n[s]=[]),f(n[s],o),t[s]=a(s))},p=function(e,t){var n=function(e,t){for(var n in t)t.hasOwnProperty(n)&&d(c(e,n),t[n])};n(e,t.getRoutes()),n(e,t.getParameterizedRoutes()),h(t.getErrorHandlers())},h=function(e){f(r,e)},v={getRoutes:function(){return e},getParameterizedRoutes:function(){return n},getParameterizedRouteInfo:function(){return t},getErrorHandlers:function(){return r},use:function(e,t){if(o.isString(e))o.isFunction(t.getRoutes)?p(e,t):o.isFunction(t)&&t.all(e,t);else if(o.isFunction(e.getRoutes))p("",t);else{if(!o.isFunction(e))throw new Error("Invalid first parameters "+e+" for router.use()");l(s("all",e))}},all:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,s.apply(void 0,["all"].concat(n)))},put:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,s.apply(void 0,["put"].concat(n)))},post:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,s.apply(void 0,["post"].concat(n)))},patch:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,s.apply(void 0,["patch"].concat(n)))},get:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,s.apply(void 0,["get"].concat(n)))},delete:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,s.apply(void 0,["delete"].concat(n)))},error:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];h(s.apply(void 0,["all"].concat(t)))},handle:function(e,t){var n=u(e.route),r=v.getRoutes()[n],o=r?f([],r):[],s=function(e){var n=f([],v.getErrorHandlers()),r=function(e){var n=e.status||500,r=e.message||e;t.status(n).send(r)};i(e,t,n,r,function(t){t||r(e)})},a=function(){var r=v.getParameterizedRoutes(),o=v.getParameterizedRouteInfo(),u=[],a=1/0,c=void 0,f=void 0;for(var l in o)if(o.hasOwnProperty(l)){var d=n.match(o[l].regex);null!==d&&d.length<a&&(a=d.length,c=l,f=d)}if(c){var p=o[c].paramNames;u=r[c],e.params={};for(var h=0;h<p.length;h++)e.params[p[h]]=f[h+1]}i(e,t,u,s,function(e){if(!e){var t=new Error("Not Found");t.status=404,s(t)}})};i(e,t,o,s,function(e){e||a()})}};return v};t.exports=l},{"./util.js":6}],5:[function(e,t,n){"use strict";var r=function(e){return{onOpen:function(t){e.onopen=t},onClose:function(t){e.onclose=t},onError:function(t){e.onerror=t},onMessage:function(t){e.onmessage=function(e){t(e.data)}},send:e.send.bind(e),close:e.close.bind(e)}},o=function(e){function t(t,n){e.removeAllListeners(t),e.on(t,n)}return{onOpen:t.bind(null,"open"),onClose:t.bind(null,"close"),onError:t.bind(null,"error"),onMessage:t.bind(null,"message"),send:e.send.bind(e),close:e.close.bind(e)}};t.exports=function(e){return e.on?o(e):r(e)}},{}],6:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./options.js"),s={stringify:function(e){return s.isString(e)?e:o.stringify(e)},parse:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(s.isString(e))try{return o.parse(e)}catch(e){if(t)return t;throw e}return e},isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e},isObject:function(e){return"object"===("undefined"==typeof e?"undefined":r(e))},endsWith:function(e,t){return e.indexOf(t,e.length-t.length)!==-1},startsWith:function(e,t){return 0===e.lastIndexOf(t,0)},regexEscape:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};t.exports=s},{"./options.js":2}],7:[function(e,t,n){"use strict";var r=e("../util.js"),o=e("../request.cache.js");t.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Socket was closed locally",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;o.rejectAll(n,t),e.close(n,r.stringify(t))}},{"../request.cache.js":3,"../util.js":6}],8:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o){return e.http("delete",t,n,r,o)}},{}],9:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o){var s=t;if(n){var i=[];for(var u in n)n.hasOwnProperty(u)&&i.push(encodeURIComponent(u)+"="+encodeURIComponent(n[u]));s=t+"?"+i.join("&")}return e.http("get",s,void 0,r,o)}},{}],10:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o,s){return e.request({verb:t,route:n,body:r},o,s)}},{}],11:[function(e,t,n){"use strict";t.exports=function(t,n){var r=n&&n.router?n.router:null,o={};return o.send=e("./send.js").bind(null,t),o.close=e("./close.js").bind(null,t),o.request=e("./request.js").bind(null,o),o.respond=e("./respond.js").bind(null,o),o.respondWithError=e("./respond.with.error.js").bind(null,o),o.http=e("./http.js").bind(null,o),o.get=e("./get.js").bind(null,o),o.post=e("./post.js").bind(null,o),o.put=e("./put.js").bind(null,o),o.patch=e("./patch.js").bind(null,o),o.delete=e("./delete.js").bind(null,o),o.onOpen=t.onOpen,o.onError=t.onError,o.onMessage=e("./on.message.js").bind(null,t,o,r),o.onClose=e("./on.close.js").bind(null,t),o.onMessage(function(e){}),o.onClose(function(e,t){}),o}},{"./close.js":7,"./delete.js":8,"./get.js":9,"./http.js":10,"./on.close.js":12,"./on.message.js":13,"./patch.js":14,"./post.js":15,"./put.js":16,"./request.js":17,"./respond.js":18,"./respond.with.error.js":19,"./send.js":20}],12:[function(e,t,n){"use strict";var r=e("../util.js"),o=e("../request.cache.js");t.exports=function(e,t){e.onClose(function(e,n){var s=r.parse(n,n);o.rejectAll(e,s),t(s,e)})}},{"../request.cache.js":3,"../util.js":6}],13:[function(e,t,n){"use strict";var r=e("../util.js"),o=e("../request.cache.js"),s=function(e,t,n){t?o.resolve(e,t):n?o.reject(e,n):o.reject(e,new Error("Got a response object without a response or error property"))},i=function(e,t,n,r){var o=r.route.indexOf("?")>=0,s=o?r.route.substr(0,r.route.indexOf("?")):r.route,i=o?r.route.substr(r.route.indexOf("?")+1).split("&"):[],u={};if(i&&i.length>0)for(var a=0;a<i.length;a++){var c=decodeURIComponent(i[a].substr(0,i[a].indexOf("=")));u[c]=decodeURIComponent(i[a].substr(i[a].indexOf("=")+1))}var f={id:n,verb:r.verb,body:r.body,route:s,query:u},l={_status:200,sent:!1,status:function(e){return l._status=e,l},respond:function(t){l.sent=!0,e.respond(n,t)},respondWithError:function(t){l.sent=!0,e.respondWithError(n,t)},send:function(e){var t={status:l._status,body:e};l._status>=200&&l._status<300?l.respond(t):l.respondWithError(t)}};t.handle(f,l)},u=function(e,t,n,r){var o={id:t,isRequest:!0,body:n},s={sent:!1,respond:function(n){s.sent=!0,e.respond(t,n)},respondWithError:function(n){s.sent=!0,e.respondWithError(t,n)},send:e.send};r(o,s)},a=function(e,t,n){var r={isRequest:!1,body:t};n(r,e)};t.exports=function(e,t,n,o){e.onMessage(function(e){var c=void 0;try{c=r.parse(e)}catch(e){return void t.send(e)}c.responseId?s(c.responseId,c.response,c.error):c.requestId?n&&c.request&&c.request.verb&&c.request.route?i(t,n,c.requestId,c.request):u(t,c.requestId,c.request,o):a(t,c,o)})}},{"../request.cache.js":3,"../util.js":6}],14:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o){return e.http("patch",t,n,r,o)}},{}],15:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o){return e.http("post",t,n,r,o)}},{}],16:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o){return e.http("put",t,n,r,o)}},{}],17:[function(e,t,n){"use strict";var r=e("../options.js"),o=e("../request.cache.js");t.exports=function(e,t,n,s){var i={requestId:r.generateRequestId(),request:t};if(n&&setTimeout(function(){o.reject(i.requestId,new Error("Timed out after "+n+" ms"))},n),!s){if(r.Promise)return new r.Promise(function(t,n){o.addPromise(i.requestId,t,n),e.send(i)});throw new Error("Can\t make a request without a Promise implementation or callback")}o.addCallback(i.requestId,s),e.send(i)}},{"../options.js":2,"../request.cache.js":3}],18:[function(e,t,n){"use strict";t.exports=function(e,t,n){e.send({responseId:t,response:n})}},{}],19:[function(e,t,n){"use strict";t.exports=function(e,t,n){e.send({responseId:t,error:n})}},{}],20:[function(e,t,n){"use strict";var r=e("../util.js");t.exports=function(e,t){e.send(r.stringify(t))}},{"../util.js":6}]},{},[1]);
