!function e(n,r,t){function o(c,i){if(!r[c]){if(!n[c]){var u="function"==typeof require&&require;if(!i&&u)return u(c,!0);if(s)return s(c,!0);var a=new Error("Cannot find module '"+c+"'");throw a.code="MODULE_NOT_FOUND",a}var l=r[c]={exports:{}};n[c][0].call(l.exports,function(e){var r=n[c][1][e];return o(r?r:e)},l,l.exports,e,n,r,t)}return r[c].exports}for(var s="function"==typeof require&&require,c=0;c<t.length;c++)o(t[c]);return o}({1:[function(e,n,r){"use strict";function t(e){if(Array.isArray(e)){for(var n=0,r=Array(e.length);n<e.length;n++)r[n]=e[n];return r}return Array.from(e)}var o=e("./standardize.js"),s=e("./websocket/index.js"),c=e("./options.js"),i=e("./request.cache.js"),u=e("./util.js"),a=[],l=void 0,d=void 0,f=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),t=1;t<n;t++)r[t-1]=arguments[t];for(var o=0;o<r.length;o++)u.isFunction(r[o].extendRapportConstructor)&&r[o].extendRapportConstructor(e)},p=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),t=1;t<n;t++)r[t-1]=arguments[t];for(var o=0;o<r.length;o++)u.isFunction(r[o].extendRapportInstance)&&r[o].extendRapportInstance(e)},g=function(e,n,r,t){for(var o=arguments.length,s=Array(o>4?o-4:0),c=4;c<o;c++)s[c-4]=arguments[c];for(var i=0;i<s.length;i++)u.isFunction(s[i].extendWebsocket)&&s[i].extendWebsocket(e,n,r,t)},x=function(e,n){var r={plugins:[].concat(a),options:c(n,l),Websocket:e||d,constructWebsocket:function(e,n){return new r.Websocket(e,n.protocols,n.connection)},use:function(e){return r.plugins.push(e),p(r,e),r},websocket:function(e){return r.Websocket=e,r},configure:function(e){return r.options=c(e,r.options),r},create:function(e,n){if(!r.Websocket)throw new Error("A websocket implementation must be supplied to create Rapport websockets");var t=c(n,r.options);return r.wrap(r.constructWebsocket(e,t),t)},wrap:function(e,n){var u=c(n,r.options),a=i(),l=o(e),d=s(l,a,u);return g.apply(void 0,[d,l,a,u].concat(t(r.plugins))),d.onOpen(function(){}),d.onMessage(function(e){}),d.onError(function(){}),d.onClose(function(e,n){}),d}};return p.apply(void 0,[r].concat(t(r.plugins))),r},v=x;v.use=function(e){return a.push(e),f(v,e),v},v.configure=function(e){return l=c(e,l),v},v.websocket=function(e){return d=e,v},v.create=function(e,n){return x(d,n).create(e)},v.wrap=function(e,n){return x(d,n).wrap(e)},v.standardize=o,"undefined"!=typeof window&&(window.Rapport=v),"undefined"!=typeof n&&(n.exports=v)},{"./options.js":2,"./request.cache.js":3,"./standardize.js":4,"./util.js":5,"./websocket/index.js":7}],2:[function(e,n,r){"use strict";var t=e("./util.js"),o=function(e){return JSON.stringify(e,function(e,n){return n instanceof Error?{name:n.name,message:n.message,stack:n.stack}:n})},s=function(e){return t.isString(e)?JSON.parse(e):e},c={encodeMessage:o,decodeMessage:s,encodeCloseMessage:o,decodeCloseMessage:s,Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Date.now(),r=(n+16*Math.random())%16|0;return("x"===e?r:3&r|8).toString(16)})}};n.exports=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var t={},o=[].concat(n,[c]),s=0;s<o.length;s++)for(var i in o[s])o[s].hasOwnProperty(i)&&"undefined"==typeof t[i]&&(t[i]=o[s][i]);return t}},{"./util.js":5}],3:[function(e,n,r){"use strict";var t=e("./util.js");n.exports=function(){var e={closeKey:"close",requests:{},addCallback:function(n,r){e.requests[n]={cb:r}},addPromise:function(n,r,t){e.requests[n]={resolve:r,reject:t}},resolve:function(n,r){e.requests[n]&&(e.requests[n].cb?e.requests[n].cb(r):e.requests[n].resolve(r),delete e.requests[n])},reject:function(n,r){e.requests[n]&&(e.requests[n].cb?e.requests[n].cb(null,r):e.requests[n].reject(r),delete e.requests[n])},rejectAll:function(n,r,o){var s=n;r&&(s=s+" with code: "+r),o&&(s=t.isString(o)?s+" and message: "+o:s+" and message: "+JSON.stringify(o));var c=new Error(s);for(var i in e.requests)e.requests.hasOwnProperty(i)&&e.reject(i,c)}};return e}},{"./util.js":5}],4:[function(e,n,r){"use strict";var t=function(e){return e.binaryType="arraybuffer",{onOpen:function(n){e.onopen=n},onClose:function(n){e.onclose=n},onError:function(n){e.onerror=n},onMessage:function(n){e.onmessage=function(e){n(e.data)}},send:e.send.bind(e),close:e.close.bind(e),socket:e}},o=function(e){var n=function(n,r,t,o){n[r]&&e.removeEventListener(t,n[r]),n[r]=o,e.on(t,o)},r={_openHandler:null,_closeHandler:null,_errorHandler:null,_messageHandler:null,onOpen:function(e){return n(r,"_openHandler","open",e)},onClose:function(e){return n(r,"_closeHandler","close",e)},onError:function(e){return n(r,"_errorHandler","error",e)},onMessage:function(e){return n(r,"_messageHandler","message",e)},send:e.send.bind(e),close:e.close.bind(e),socket:e};return r};n.exports=function(e){return e.on?o(e):t(e)}},{}],5:[function(e,n,r){"use strict";var t={isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e}};n.exports=t},{}],6:[function(e,n,r){"use strict";n.exports=function(e,n,r){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Socket was closed",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments[6];if(n.rejectAll("Websocket was closed locally",o,t),s&&setTimeout(function(){n.reject(n.closeKey,new Error("Timed out after "+s+" ms"))},s),!c){if(r.Promise)return new r.Promise(function(s,c){n.addPromise(n.closeKey,s,c),e.close(o,r.encodeCloseMessage(t))});throw new Error("Can't close without a Promise implementation or callback")}n.addCallback(n.closeKey,c),e.close(o,r.encodeCloseMessage(t))}},{}],7:[function(e,n,r){"use strict";n.exports=function(n,r,t){var o={},s={send:e("./send.js"),close:e("./close.js"),request:e("./request.js"),respond:e("./respond.js"),respondWithError:e("./respond.with.error.js"),onOpen:n.onOpen,onError:n.onError,onMessage:e("./on.message.js")(),onClose:e("./on.close.js")};return o.send=s.send.bind(null,n,t),o.close=s.close.bind(null,n,r,t),o.request=s.request.bind(null,o,r,t),o.respond=s.respond.bind(null,o,t),o.respondWithError=s.respondWithError.bind(null,o,t),o.onOpen=s.onOpen,o.onError=s.onError,o.onMessage=s.onMessage.bind(null,n,o,r,t),o.onClose=s.onClose.bind(null,n,r,t),o._functions=s,o.raw=n.socket,o}},{"./close.js":6,"./on.close.js":8,"./on.message.js":9,"./request.js":10,"./respond.js":11,"./respond.with.error.js":12,"./send.js":13}],8:[function(e,n,r){"use strict";n.exports=function(e,n,r,t){e.onClose(function(e,o){var s=void 0;try{s=r.decodeCloseMessage(o)}catch(e){s=o}n.resolve(n.closeKey),n.rejectAll("Websocket was closed remotely",e,s),t(s,e)})}},{}],9:[function(e,n,r){"use strict";var t=function e(n,r,t,o,s){n.onMessage(function(c){var i=void 0;try{i=o.decodeMessage(c)}catch(e){return void r.send(e)}i._rs?e.handleResponse(n,r,t,o,i._rs,i._b,i._e):i._rq?e.handleRequest(n,r,t,o,i._rq,i._b,s):e.handleMessage(n,r,t,o,i,s)})},o=function(e,n,r,t,o,s,c){s?r.resolve(o,s):c?r.reject(o,c):r.reject(o,new Error("Got a response object without a response or error property"))},s=function(e,n,r,o,s,c,i){i(t.createRequestObject(e,n,r,o,c,s),t.createResponderObject(e,n,r,o,s))},c=function(e,n,r,o,s,c){c(t.createRequestObject(e,n,r,o,s),n)},i=function(e,n,r,t,o,s){return s?{id:s,isRequest:!0,body:o}:{isRequest:!1,body:o}},u=function(e,n,r,t,o){var s={sent:!1,respond:function(e){s.sent=!0,n.respond(o,e)},respondWithError:function(e){s.sent=!0,n.respondWithError(o,e)},send:n.send};return s};n.exports=function(){var e=t;return e.handleResponse=o,e.handleRequest=s,e.handleMessage=c,e.createRequestObject=i,e.createResponderObject=u,e}},{}],10:[function(e,n,r){"use strict";n.exports=function(e,n,r,t,o,s){var c={_rq:r.generateRequestId(),_b:t};o&&setTimeout(function(){n.reject(c._rq,new Error("Timed out after "+o+" ms"))},o);var i=function(r){try{e.send(r)}catch(e){n.reject(r._rq,e)}};if(!s){if(r.Promise)return new r.Promise(function(e,r){n.addPromise(c._rq,e,r),i(c)});throw new Error("Can't make a request without a Promise implementation or callback")}n.addCallback(c._rq,s),i(c)}},{}],11:[function(e,n,r){"use strict";n.exports=function(e,n,r,t){e.send({_rs:r,_b:t})}},{}],12:[function(e,n,r){"use strict";n.exports=function(e,n,r,t){e.send({_rs:r,_e:t})}},{}],13:[function(e,n,r){"use strict";n.exports=function(e,n,r){e.send(n.encodeMessage(r))}},{}]},{},[1]);
