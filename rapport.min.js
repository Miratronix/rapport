!function e(n,r,s){function t(i,u){if(!r[i]){if(!n[i]){var c="function"==typeof require&&require;if(!u&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var a=r[i]={exports:{}};n[i][0].call(a.exports,function(e){var r=n[i][1][e];return t(r?r:e)},a,a.exports,e,n,r,s)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<s.length;i++)t(s[i]);return t}({1:[function(e,n,r){"use strict";var s=e("./standardize.js"),t=e("./websocket/index.js"),o=e("./options.js"),i=function(e,n){o.initialize(n);var r={create:function(n,s){return r.wrap(new e(n,s))},wrap:function(e){var n=t(s(e));return n.onMessage(function(e){}),n.onClose(function(e,n){}),n}};return r};"undefined"!=typeof window&&(window.Rapport=i),"undefined"!=typeof n&&(n.exports=i)},{"./options.js":2,"./standardize.js":4,"./websocket/index.js":7}],2:[function(e,n,r){"use strict";var s={initialize:function(e){e&&(e.stringify&&(s.stringify=e.stringify),e.parse&&(s.parse=e.parse),e.Promise&&(s.Promise=e.Promise),e.generateRequestId&&(s.generateRequestId=e.generateRequestId))},stringify:JSON.stringify,parse:JSON.parse,Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Date.now(),r=(n+16*Math.random())%16|0;return("x"===e?r:3&r|8).toString(16)})}};n.exports=s},{}],3:[function(e,n,r){"use strict";var s=e("./util.js"),t={},o={addCallback:function(e,n){t[e]={cb:n}},addPromise:function(e,n,r){t[e]={resolve:n,reject:r}},resolve:function(e,n){t[e]&&(t[e].cb?t[e].cb(n):t[e].resolve(n),delete t[e])},reject:function(e,n){t[e]&&(t[e].cb?t[e].cb(null,n):t[e].reject(n),delete t[e])},rejectAll:function(e,n){Object.keys(t).forEach(function(r){o.reject(r,new Error("Websocket has been closed: "+e+" - "+s.stringify(n)))})}};n.exports=o},{"./util.js":5}],4:[function(e,n,r){"use strict";var s=function(e){return{onOpen:function(n){e.onopen=n},onClose:function(n){e.onclose=n},onError:function(n){e.onerror=n},onMessage:function(n){e.onmessage=function(e){n(e.data)}},send:e.send.bind(e),close:e.close.bind(e)}},t=function(e){function n(n,r){e.removeAllListeners(n),e.on(n,r)}return{onOpen:n.bind(null,"open"),onClose:n.bind(null,"close"),onError:n.bind(null,"error"),onMessage:n.bind(null,"message"),send:e.send.bind(e),close:e.close.bind(e)}};n.exports=function(e){return e.on?t(e):s(e)}},{}],5:[function(e,n,r){"use strict";var s=e("./options.js"),t={stringify:function(e){return"string"==typeof e?e:s.stringify(e)},parse:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("string"==typeof e)try{return s.parse(e)}catch(e){if(n)return n;throw e}return e}};n.exports=t},{"./options.js":2}],6:[function(e,n,r){"use strict";var s=e("../util.js"),t=e("../request.cache.js");n.exports=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Socket was closed locally",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;t.rejectAll(r,n),e.close(r,s.stringify(n))}},{"../request.cache.js":3,"../util.js":5}],7:[function(e,n,r){"use strict";n.exports=function(n){var r={};return r.send=e("./send.js").bind(null,n),r.close=e("./close.js").bind(null,n),r.request=e("./request.js").bind(null,r),r.respond=e("./respond.js").bind(null,r),r.respondWithError=e("./respond.with.error.js").bind(null,r),r.onOpen=n.onOpen,r.onError=n.onError,r.onMessage=e("./on.message.js").bind(null,n,r),r.onClose=e("./on.close.js").bind(null,n),r}},{"./close.js":6,"./on.close.js":8,"./on.message.js":9,"./request.js":10,"./respond.js":11,"./respond.with.error.js":12,"./send.js":13}],8:[function(e,n,r){"use strict";var s=e("../util.js"),t=e("../request.cache.js");n.exports=function(e,n){e.onClose(function(e,r){var o=s.parse(e,e);t.rejectAll(r,o),n(o,r)})}},{"../request.cache.js":3,"../util.js":5}],9:[function(e,n,r){"use strict";var s=e("../util.js"),t=e("../request.cache.js"),o=function(e,n,r){n?t.resolve(e,n):r?t.reject(e,r):t.reject(e,new Error("Got a response object without a response or error property"))},i=function(e,n,r,s){s(r,{requestId:n,shouldRespond:!0,respond:e.respond.bind(null,n),respondWithError:e.respondWithError.bind(null,n),send:e.send})},u=function(e,n,r){r(n,{shouldRespond:!1,send:e.send})};n.exports=function(e,n,r){e.onMessage(function(e){var t=void 0;try{t=s.parse(e)}catch(e){return void n.send(e)}t.responseId?o(t.responseId,t.response,t.error):t.requestId?i(n,t.requestId,t.request,r):u(n,t,r)})}},{"../request.cache.js":3,"../util.js":5}],10:[function(e,n,r){"use strict";var s=e("../options.js"),t=e("../request.cache.js");n.exports=function(e,n,r,o){var i={requestId:s.generateRequestId(),request:n};if(r&&setTimeout(function(){t.reject(i.requestId,new Error("Timed out after "+r+" ms"))},r),!o){if(s.Promise)return new s.Promise(function(n,r){t.addPromise(i.requestId,n,r),e.send(i)});throw new Error("Can\t make a request without a Promise implementation or callback")}t.addCallback(i.requestId,o),e.send(i)}},{"../options.js":2,"../request.cache.js":3}],11:[function(e,n,r){"use strict";n.exports=function(e,n,r){e.send({responseId:n,response:r})}},{}],12:[function(e,n,r){"use strict";n.exports=function(e,n,r){e.send({responseId:n,error:r})}},{}],13:[function(e,n,r){"use strict";var s=e("../util.js");n.exports=function(e,n){e.send(s.stringify(n))}},{"../util.js":5}]},{},[1]);
