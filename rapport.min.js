!function e(n,r,o){function t(i,u){if(!r[i]){if(!n[i]){var c="function"==typeof require&&require;if(!u&&c)return c(i,!0);if(s)return s(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var d=r[i]={exports:{}};n[i][0].call(d.exports,function(e){var r=n[i][1][e];return t(r?r:e)},d,d.exports,e,n,r,o)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<o.length;i++)t(o[i]);return t}({1:[function(e,n,r){"use strict";function o(e){if(Array.isArray(e)){for(var n=0,r=Array(e.length);n<e.length;n++)r[n]=e[n];return r}return Array.from(e)}var t=e("./standardize.js"),s=e("./websocket/index.js"),i=e("./options.js"),u=e("./request.cache.js"),c=e("./util.js"),a=[],d=void 0,f=void 0,l=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];for(var t=0;t<r.length;t++)c.isFunction(r[t].extendRapportConstructor)&&r[t].extendRapportConstructor(e)},p=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];for(var t=0;t<r.length;t++)c.isFunction(r[t].extendRapportInstance)&&r[t].extendRapportInstance(e)},x=function(e,n,r,o){for(var t=arguments.length,s=Array(t>4?t-4:0),i=4;i<t;i++)s[i-4]=arguments[i];for(var u=0;u<s.length;u++)c.isFunction(s[u].extendWebsocket)&&s[u].extendWebsocket(e,n,r,o)},g=function(e,n){var r={plugins:[].concat(a),options:i(n,d),Websocket:e||f,constructWebsocket:function(e,n){return new r.Websocket(e,n.protocols,n.connection)},use:function(e){return r.plugins.push(e),p(r,e),r},websocket:function(e){return r.Websocket=e,r},configure:function(e){return r.options=i(e,r.options),r},create:function(e,n){if(!r.Websocket)throw new Error("A websocket implementation must be supplied to create Rapport websockets");var o=i(n,r.options);return r.wrap(r.constructWebsocket(e,o),o)},wrap:function(e,n){var c=i(n,r.options),a=u(),d=t(e),f=s(d,a,c);return x.apply(void 0,[f,d,a,c].concat(o(r.plugins))),f.onOpen(function(){}),f.onMessage(function(e){}),f.onError(function(){}),f.onClose(function(e,n){}),f}};return p.apply(void 0,[r].concat(o(r.plugins))),r},v=g;v.use=function(e){return a.push(e),l(v,e),v},v.configure=function(e){return d=i(e,d),v},v.websocket=function(e){return f=e,v},v.create=function(e,n){return g(f,n).create(e)},v.wrap=function(e,n){return g(f,n).wrap(e)},v.standardize=t,"undefined"!=typeof window&&(window.Rapport=v),"undefined"!=typeof n&&(n.exports=v)},{"./options.js":2,"./request.cache.js":3,"./standardize.js":4,"./util.js":5,"./websocket/index.js":7}],2:[function(e,n,r){"use strict";var o=e("./util.js"),t=function(e){return JSON.stringify(e,function(e,n){return n instanceof Error?{name:n.name,message:n.message,stack:n.stack}:n})},s=function(e){return o.isString(e)?JSON.parse(e):e},i={encodeMessage:t,decodeMessage:s,encodeCloseMessage:t,decodeCloseMessage:s,Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Date.now(),r=(n+16*Math.random())%16|0;return("x"===e?r:3&r|8).toString(16)})}};n.exports=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var o={},t=[].concat(n,[i]),s=0;s<t.length;s++)for(var u in t[s])t[s].hasOwnProperty(u)&&!o[u]&&(o[u]=t[s][u]);return o}},{"./util.js":5}],3:[function(e,n,r){"use strict";var o=e("./util.js");n.exports=function(){var e={requests:{},addCallback:function(n,r){e.requests[n]={cb:r}},addPromise:function(n,r,o){e.requests[n]={resolve:r,reject:o}},resolve:function(n,r){e.requests[n]&&(e.requests[n].cb?e.requests[n].cb(r):e.requests[n].resolve(r),delete e.requests[n])},reject:function(n,r){e.requests[n]&&(e.requests[n].cb?e.requests[n].cb(null,r):e.requests[n].reject(r),delete e.requests[n])},rejectAll:function(n,r,t){var s=n;r&&(s=s+" with code: "+r),t&&(s=o.isString(t)?s+" and message: "+t:s+" and message: "+JSON.stringify(t));var i=new Error(s);for(var u in e.requests)e.requests.hasOwnProperty(u)&&e.reject(u,i)}};return e}},{"./util.js":5}],4:[function(e,n,r){"use strict";var o=function(e){return e.binaryType="arraybuffer",{onOpen:function(n){e.onopen=n},onClose:function(n){e.onclose=n},onError:function(n){e.onerror=n},onMessage:function(n){e.onmessage=function(e){n(e.data)}},send:e.send.bind(e),close:e.close.bind(e),socket:e}},t=function(e){var n=function(n,r){e.removeAllListeners(n),e.on(n,r)};return{onOpen:n.bind(null,"open"),onClose:n.bind(null,"close"),onError:n.bind(null,"error"),onMessage:n.bind(null,"message"),send:e.send.bind(e),close:e.close.bind(e),socket:e}};n.exports=function(e){return e.on?t(e):o(e)}},{}],5:[function(e,n,r){"use strict";var o={isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e}};n.exports=o},{}],6:[function(e,n,r){"use strict";n.exports=function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Socket was closed",t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3;n.rejectAll("Websocket was closed locally",t,o),e.close(t,r.encodeCloseMessage(o))}},{}],7:[function(e,n,r){"use strict";n.exports=function(n,r,o){var t={},s={send:e("./send.js"),close:e("./close.js"),request:e("./request.js"),respond:e("./respond.js"),respondWithError:e("./respond.with.error.js"),onOpen:n.onOpen,onError:n.onError,onMessage:e("./on.message.js"),onClose:e("./on.close.js")};return t.send=s.send.bind(null,n,o),t.close=s.close.bind(null,n,r,o),t.request=s.request.bind(null,t,r,o),t.respond=s.respond.bind(null,t,o),t.respondWithError=s.respondWithError.bind(null,t,o),t.onOpen=s.onOpen,t.onError=s.onError,t.onMessage=s.onMessage.bind(null,n,t,r,o),t.onClose=s.onClose.bind(null,n,r,o),t._functions=s,t}},{"./close.js":6,"./on.close.js":8,"./on.message.js":9,"./request.js":10,"./respond.js":11,"./respond.with.error.js":12,"./send.js":13}],8:[function(e,n,r){"use strict";n.exports=function(e,n,r,o){e.onClose(function(e,t){var s=void 0;try{s=r.decodeCloseMessage(t)}catch(e){s=t}n.rejectAll("Websocket was closed remotely",e,s),o(s,e)})}},{}],9:[function(e,n,r){"use strict";var o=function e(n,r,o,t,s){n.onMessage(function(n){var i=void 0;try{i=t.decodeMessage(n)}catch(e){return void r.send(e)}i.responseId?e.handleResponse(o,i.responseId,i.body,i.error):i.requestId?e.handleRequest(r,i.requestId,i.body,s):e.handleMessage(r,i,s)})};o.handleResponse=function(e,n,r,o){r?e.resolve(n,r):o?e.reject(n,o):e.reject(n,new Error("Got a response object without a response or error property"))},o.handleRequest=function(e,n,r,o){var t={id:n,isRequest:!0,body:r},s={sent:!1,respond:function(r){s.sent=!0,e.respond(n,r)},respondWithError:function(r){s.sent=!0,e.respondWithError(n,r)},send:e.send};o(t,s)},o.handleMessage=function(e,n,r){var o={isRequest:!1,body:n};r(o,e)},n.exports=o},{}],10:[function(e,n,r){"use strict";n.exports=function(e,n,r,o,t,s){var i={requestId:r.generateRequestId(),body:o};if(t&&setTimeout(function(){n.reject(i.requestId,new Error("Timed out after "+t+" ms"))},t),!s){if(r.Promise)return new r.Promise(function(r,o){n.addPromise(i.requestId,r,o),e.send(i)});throw new Error("Can't make a request without a Promise implementation or callback")}n.addCallback(i.requestId,s),e.send(i)}},{}],11:[function(e,n,r){"use strict";n.exports=function(e,n,r,o){e.send({responseId:r,body:o})}},{}],12:[function(e,n,r){"use strict";n.exports=function(e,n,r,o){e.send({responseId:r,error:o})}},{}],13:[function(e,n,r){"use strict";n.exports=function(e,n,r){e.send(n.encodeMessage(r))}},{}]},{},[1]);
