!function e(t,r,n){function o(i,u){if(!r[i]){if(!t[i]){var a="function"==typeof require&&require;if(!u&&a)return a(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[i]={exports:{}};t[i][0].call(l.exports,function(e){var r=t[i][1][e];return o(r?r:e)},l,l.exports,e,t,r,n)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){"use strict";var n=e("./standardize.js"),o=e("./websocket/index.js"),s=e("./options.js"),i=e("./util.js"),u=function(t,r){s.initialize(r);var u={Router:e("./router.js"),create:function(e,r){var n=void 0;return r&&i.isObject(r)&&(n=r.ws,delete r.ws),u.wrap(new t(e,n),r)},wrap:function(e,t){if(t&&t.router&&!i.isObject(t.router)&&!i.isFunction(t.router.handle))throw new Error("Please supply a rapport router as the router property");return o(n(e),t)}};return u};"undefined"!=typeof window&&(window.Rapport=u),"undefined"!=typeof t&&(t.exports=u)},{"./options.js":2,"./router.js":4,"./standardize.js":5,"./util.js":6,"./websocket/index.js":11}],2:[function(e,t,r){"use strict";var n={initialize:function(e){e&&(e.stringify&&(n.stringify=e.stringify),e.parse&&(n.parse=e.parse),e.Promise&&(n.Promise=e.Promise),e.generateRequestId&&(n.generateRequestId=e.generateRequestId))},stringify:function(e){return e instanceof Error?JSON.stringify({name:e.name,message:e.message,stack:e.stack}):JSON.stringify(e)},parse:JSON.parse,Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Date.now(),r=(t+16*Math.random())%16|0;return("x"===e?r:3&r|8).toString(16)})}};t.exports=n},{}],3:[function(e,t,r){"use strict";var n=e("./util.js"),o={},s={addCallback:function(e,t){o[e]={cb:t}},addPromise:function(e,t,r){o[e]={resolve:t,reject:r}},resolve:function(e,t){o[e]&&(o[e].cb?o[e].cb(t):o[e].resolve(t),delete o[e])},reject:function(e,t){o[e]&&(o[e].cb?o[e].cb(null,t):o[e].reject(t),delete o[e])},rejectAll:function(e,t){Object.keys(o).forEach(function(r){s.reject(r,new Error("Websocket has been closed: "+e+" - "+n.stringify(t)))})}};t.exports=s},{"./util.js":6}],4:[function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var o=e("path-to-regexp"),s=e("./util.js"),i=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=[];if(!r||0===r.length)throw new Error("Please supply at least one handler for the route");for(var i=0;i<r.length;i++){var u={method:e};if(!s.isFunction(r[i]))throw new Error("Please supply only handler functions to rapport route methods");u.handle=r[i],o.push(u)}return o},u=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].method]=!0;return t},a=function(e,t,r,n){var o=function o(){if(r.length>0){var i=r.shift();if("all"===i.method||i.method===e.method)try{var u=i.handle(e,t,o);u&&s.isFunction(u.then)&&u.then(o,n)}catch(e){n(e)}}};o()},c=function(){for(var e=arguments.length,t=Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];for(var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=0;s<t.length;s++)t[s]&&0!==t[s].length&&o.push.apply(o,n(t[s]));return o},l=function(e){var t=[];return o(e,t),0!==t.length},f=function(e,t){var r=s.trimSlashes(e),n=s.trimSlashes(t);return 0!==r.length&&0!==n.length?r+"/"+n:0===r.length?n:r},d=function(){var e={},t=[],r=[],n=[],d=function n(i,a){if(s.isArray(i))for(var f=0;f<i.length;f++)n(i[f],a);else{if(!s.isString(i))throw new Error("Only string routes can be used for routing");var d=s.trimSlashes(i);if(l(i)){for(var p=0;p<t.length;p++)if(t[p].route===i)return c(t[p].chain,a),void(t[p].handledMethods=u(t[p].chain));var h=[],g=o(i,h),v=c([],r,a),y=u(v);t.push({route:i,keys:h,regex:g,handledMethods:y,chain:v})}else e[d]||(e[d]={chain:c([],r)}),c(e[d].chain,a),e[d].handledMethods=u(e[d].chain)}},p=function(e){c(n,e)},h=function(n){c(r,n),s.forEach(e,function(e,t){c(t.chain,n),t.handledMethods=u(t.chain)});for(var o=0;o<t.length;o++)c(t[o].chain,n),t[o].handledMethods=u(t[o].chain)},g=function e(t,r){if(s.isArray(t))for(var n=0;n<t.length;n++)e(t[n],r);else if(s.isArray(r))for(var o=0;o<r.length;o++)e(t,r[o]);else{if(!s.isString(t))throw new Error("Only string routes can be used for routing");if(!(s.isObject(r)&&s.isFunction(r.getRoutes)&&s.isFunction(r.getRegexRoutes)&&s.isFunction(r.getErrorHandlers)))throw new Error("Only Rapport routers can be added to a route with use()");s.forEach(r.getRoutes(),function(e,r){d(f(t,e),r.chain)});for(var i=r.getRegexRoutes(),u=0;u<i.length;u++)d(f(t,i[u].route),i[u].chain);p(r.getErrorHandlers())}},v={getRoutes:function(){return e},getRegexRoutes:function(){return t},getErrorHandlers:function(){return n},use:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(s.isString(e)||s.isArray(e)){if(!r||0===r.length)throw new Error("Please supply a router to add");g(e,r)}else if(s.isObject(e))g("",[e].concat(r));else{if(!s.isFunction(e))throw new Error("Invalid first parameter "+e+" for router.use()");h(i.apply(void 0,["all"].concat([e].concat(r))))}},all:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];d(e,i.apply(void 0,["all"].concat(r)))},put:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];d(e,i.apply(void 0,["put"].concat(r)))},post:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];d(e,i.apply(void 0,["post"].concat(r)))},patch:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];d(e,i.apply(void 0,["patch"].concat(r)))},get:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];d(e,i.apply(void 0,["get"].concat(r)))},delete:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];d(e,i.apply(void 0,["delete"].concat(r)))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];p(i.apply(void 0,["all"].concat(t)))},handle:function(e,t){var r=s.trimSlashes(e.url),n=function(e){var r=c([],v.getErrorHandlers()),n=function(e){var r=500;s.isObject(e)&&e.status&&(r=e.status,delete e.status),t.status(r).send(e)};return 0===r.length?void n(e):void a(e,t,r,n)},o=function(){for(var o=v.getRegexRoutes(),s=[],i=0;i<o.length;i++){var u=o[i],l=r.match(u.regex);if(null!==l&&(l.shift(),u.handledMethods.all||u.handledMethods[e.method])){e.params={};for(var f=0;f<u.keys.length;f++)e.params[u.keys[f].name]=l[f];c(s,u.chain);break}}if(0===s.length){var d=new Error("Not Found");return d.status=404,void n(d)}a(e,t,s,n)},i=function(){var s=v.getRoutes()[r],i=s?c([],s.chain):[];return 0===i.length||!s.handledMethods.all&&!s.handledMethods[e.method]?void o():void a(e,t,i,n)};i()}};return v};t.exports=d},{"./util.js":6,"path-to-regexp":21}],5:[function(e,t,r){"use strict";var n=function(e){return{onOpen:function(t){e.onopen=t},onClose:function(t){e.onclose=t},onError:function(t){e.onerror=t},onMessage:function(t){e.onmessage=function(e){t(e.data)}},send:e.send.bind(e),close:e.close.bind(e)}},o=function(e){function t(t,r){e.removeAllListeners(t),e.on(t,r)}return{onOpen:t.bind(null,"open"),onClose:t.bind(null,"close"),onError:t.bind(null,"error"),onMessage:t.bind(null,"message"),send:e.send.bind(e),close:e.close.bind(e)}};t.exports=function(e){return e.on?o(e):n(e)}},{}],6:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./options.js"),s={stringify:function(e){return s.isString(e)?e:o.stringify(e)},parse:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(s.isString(e))try{return o.parse(e)}catch(e){if(null!==t)return t;throw e}return e},isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e},isObject:function(e){return"object"===("undefined"==typeof e?"undefined":n(e))},isArray:function(e){return Array.isArray(e)},endsWith:function(e,t){return e.indexOf(t,e.length-t.length)!==-1},startsWith:function(e,t){return 0===e.lastIndexOf(t,0)},trimSlashes:function(e){var t=e;return s.endsWith(t,"/")&&(t=t.substring(0,t.length-1)),s.startsWith(t,"/")&&(t=t.substring(1,t.length)),t},forEach:function(e,t){for(var r in e)e.hasOwnProperty(r)&&t(r,e[r])}};t.exports=s},{"./options.js":2}],7:[function(e,t,r){"use strict";var n=e("../util.js"),o=e("../request.cache.js");t.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Socket was closed locally",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;o.rejectAll(r,t),e.close(r,n.stringify(t))}},{"../request.cache.js":3,"../util.js":6}],8:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o){return e.http("delete",t,r,n,o)}},{}],9:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o){var s=t;if(r){var i=[];for(var u in r)r.hasOwnProperty(u)&&i.push(encodeURIComponent(u)+"="+encodeURIComponent(r[u]));s=t+"?"+i.join("&")}return e.http("get",s,void 0,n,o)}},{}],10:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o,s){return e.request({method:t,url:r,body:n},o,s)}},{}],11:[function(e,t,r){"use strict";t.exports=function(t,r){var n=r&&r.router?r.router:null,o={};return o.send=e("./send.js").bind(null,t),o.close=e("./close.js").bind(null,t),o.request=e("./request.js").bind(null,o),o.respond=e("./respond.js").bind(null,o),o.respondWithError=e("./respond.with.error.js").bind(null,o),o.http=e("./http.js").bind(null,o),o.get=e("./get.js").bind(null,o),o.post=e("./post.js").bind(null,o),o.put=e("./put.js").bind(null,o),o.patch=e("./patch.js").bind(null,o),o.delete=e("./delete.js").bind(null,o),o.onOpen=t.onOpen,o.onError=t.onError,o.onMessage=e("./on.message.js").bind(null,t,o,n),o.onClose=e("./on.close.js").bind(null,t),o.onMessage(function(e){}),o.onClose(function(e,t){}),o}},{"./close.js":7,"./delete.js":8,"./get.js":9,"./http.js":10,"./on.close.js":12,"./on.message.js":13,"./patch.js":14,"./post.js":15,"./put.js":16,"./request.js":17,"./respond.js":18,"./respond.with.error.js":19,"./send.js":20}],12:[function(e,t,r){"use strict";var n=e("../util.js"),o=e("../request.cache.js");t.exports=function(e,t){e.onClose(function(e,r){var s=n.parse(r,r);o.rejectAll(e,s),t(s,e)})}},{"../request.cache.js":3,"../util.js":6}],13:[function(e,t,r){"use strict";var n=e("../util.js"),o=e("../request.cache.js"),s=function(e,t,r){t?o.resolve(e,t):r?o.reject(e,r):o.reject(e,new Error("Got a response object without a response or error property"))},i=function(e,t,r,n){var o=n.url.indexOf("?")>=0,s=o?n.url.substr(0,n.url.indexOf("?")):n.url,i=o?n.url.substr(n.url.indexOf("?")+1).split("&"):[],u={};if(i&&i.length>0)for(var a=0;a<i.length;a++){var c=decodeURIComponent(i[a].substr(0,i[a].indexOf("=")));u[c]=decodeURIComponent(i[a].substr(i[a].indexOf("=")+1))}var l={id:r,method:n.method,body:n.body,url:s,query:u},f={_status:200,sent:!1,status:function(e){return f._status=e,f},respond:function(t){f.sent=!0,e.respond(r,t)},respondWithError:function(t){f.sent=!0,e.respondWithError(r,t)},send:function(e){var t={status:f._status,body:e};f._status>=200&&f._status<300?f.respond(t):f.respondWithError(t)}};t.handle(l,f)},u=function(e,t,r,n){var o={id:t,isRequest:!0,body:r},s={sent:!1,respond:function(r){s.sent=!0,e.respond(t,r)},respondWithError:function(r){s.sent=!0,e.respondWithError(t,r)},send:e.send};n(o,s)},a=function(e,t,r){var n={isRequest:!1,body:t};r(n,e)};t.exports=function(e,t,r,o){e.onMessage(function(e){var c=void 0;try{c=n.parse(e)}catch(e){return void t.send(e)}c.responseId?s(c.responseId,c.body,c.error):c.requestId?r&&c.body&&c.body.method&&c.body.url?i(t,r,c.requestId,c.body):u(t,c.requestId,c.body,o):a(t,c,o)})}},{"../request.cache.js":3,"../util.js":6}],14:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o){return e.http("patch",t,r,n,o)}},{}],15:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o){return e.http("post",t,r,n,o)}},{}],16:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o){return e.http("put",t,r,n,o)}},{}],17:[function(e,t,r){"use strict";var n=e("../options.js"),o=e("../request.cache.js");t.exports=function(e,t,r,s){var i={requestId:n.generateRequestId(),body:t};if(r&&setTimeout(function(){o.reject(i.requestId,new Error("Timed out after "+r+" ms"))},r),!s){if(n.Promise)return new n.Promise(function(t,r){o.addPromise(i.requestId,t,r),e.send(i)});throw new Error("Can\t make a request without a Promise implementation or callback")}o.addCallback(i.requestId,s),e.send(i)}},{"../options.js":2,"../request.cache.js":3}],18:[function(e,t,r){"use strict";t.exports=function(e,t,r){e.send({responseId:t,body:r})}},{}],19:[function(e,t,r){"use strict";t.exports=function(e,t,r){e.send({responseId:t,error:r})}},{}],20:[function(e,t,r){"use strict";var n=e("../util.js");t.exports=function(e,t){e.send(n.stringify(t))}},{"../util.js":6}],21:[function(e,t,r){function n(e,t){for(var r,n=[],o=0,s=0,i="",u=t&&t.delimiter||"/";null!=(r=x.exec(e));){var l=r[0],f=r[1],d=r.index;if(i+=e.slice(s,d),s=d+l.length,f)i+=f[1];else{var p=e[s],h=r[2],g=r[3],v=r[4],y=r[5],j=r[6],b=r[7];i&&(n.push(i),i="");var m=null!=h&&null!=p&&p!==h,w="+"===j||"*"===j,E="?"===j||"*"===j,R=r[2]||u,q=v||y;n.push({name:g||o++,prefix:h||"",delimiter:R,optional:E,repeat:w,partial:m,asterisk:!!b,pattern:q?c(q):b?".*":"[^"+a(R)+"]+?"})}}return s<e.length&&(i+=e.substr(s)),i&&n.push(i),n}function o(e,t){return u(n(e,t))}function s(e){return encodeURI(e).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function i(e){return encodeURI(e).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function u(e){for(var t=new Array(e.length),r=0;r<e.length;r++)"object"==typeof e[r]&&(t[r]=new RegExp("^(?:"+e[r].pattern+")$"));return function(r,n){for(var o="",u=r||{},a=n||{},c=a.pretty?s:encodeURIComponent,l=0;l<e.length;l++){var f=e[l];if("string"!=typeof f){var d,p=u[f.name];if(null==p){if(f.optional){f.partial&&(o+=f.prefix);continue}throw new TypeError('Expected "'+f.name+'" to be defined')}if(y(p)){if(!f.repeat)throw new TypeError('Expected "'+f.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(f.optional)continue;throw new TypeError('Expected "'+f.name+'" to not be empty')}for(var h=0;h<p.length;h++){if(d=c(p[h]),!t[l].test(d))throw new TypeError('Expected all "'+f.name+'" to match "'+f.pattern+'", but received `'+JSON.stringify(d)+"`");o+=(0===h?f.prefix:f.delimiter)+d}}else{if(d=f.asterisk?i(p):c(p),!t[l].test(d))throw new TypeError('Expected "'+f.name+'" to match "'+f.pattern+'", but received "'+d+'"');o+=f.prefix+d}}else o+=f}return o}}function a(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function c(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function l(e,t){return e.keys=t,e}function f(e){return e.sensitive?"":"i"}function d(e,t){var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return l(e,t)}function p(e,t,r){for(var n=[],o=0;o<e.length;o++)n.push(v(e[o],t,r).source);var s=new RegExp("(?:"+n.join("|")+")",f(r));return l(s,t)}function h(e,t,r){return g(n(e,r),t,r)}function g(e,t,r){y(t)||(r=t||r,t=[]),r=r||{};for(var n=r.strict,o=r.end!==!1,s="",i=0;i<e.length;i++){var u=e[i];if("string"==typeof u)s+=a(u);else{var c=a(u.prefix),d="(?:"+u.pattern+")";t.push(u),u.repeat&&(d+="(?:"+c+d+")*"),d=u.optional?u.partial?c+"("+d+")?":"(?:"+c+"("+d+"))?":c+"("+d+")",s+=d}}var p=a(r.delimiter||"/"),h=s.slice(-p.length)===p;return n||(s=(h?s.slice(0,-p.length):s)+"(?:"+p+"(?=$))?"),s+=o?"$":n&&h?"":"(?="+p+"|$)",l(new RegExp("^"+s,f(r)),t)}function v(e,t,r){return y(t)||(r=t||r,t=[]),r=r||{},e instanceof RegExp?d(e,t):y(e)?p(e,t,r):h(e,t,r)}var y=e("isarray");t.exports=v,t.exports.parse=n,t.exports.compile=o,t.exports.tokensToFunction=u,t.exports.tokensToRegExp=g;var x=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g")},{isarray:22}],22:[function(e,t,r){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}]},{},[1]);
