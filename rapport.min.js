!function e(n,r,t){function o(i,u){if(!r[i]){if(!n[i]){var c="function"==typeof require&&require;if(!u&&c)return c(i,!0);if(s)return s(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var f=r[i]={exports:{}};n[i][0].call(f.exports,function(e){var r=n[i][1][e];return o(r?r:e)},f,f.exports,e,n,r,t)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(e,n,r){"use strict";function t(e){if(Array.isArray(e)){for(var n=0,r=Array(e.length);n<e.length;n++)r[n]=e[n];return r}return Array.from(e)}var o=e("./standardize.js"),s=e("./websocket/index.js"),i=e("./options.js"),u=e("./util.js"),c=[],a=void 0,f=void 0,d=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),t=1;t<n;t++)r[t-1]=arguments[t];for(var o=0;o<r.length;o++)u.isFunction(r[o].extendRapportConstructor)&&r[o].extendRapportConstructor(e)},l=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),t=1;t<n;t++)r[t-1]=arguments[t];for(var o=0;o<r.length;o++)u.isFunction(r[o].extendRapportInstance)&&r[o].extendRapportInstance(e)},p=function(e,n){for(var r=arguments.length,t=Array(r>2?r-2:0),o=2;o<r;o++)t[o-2]=arguments[o];for(var s=0;s<t.length;s++)u.isFunction(t[s].extendWebsocket)&&t[s].extendWebsocket(e,n)},x=function(e,n){var r={plugins:[].concat(c),options:i(n,a),Websocket:e||f,use:function(e){return r.plugins.push(e),l(r,e),r},websocket:function(e){return r.Websocket=e,r},configure:function(e){return r.options=i(e,r.options),r},create:function(e,n){if(!r.Websocket)throw new Error("A websocket implementation must be supplied to create Rapport websockets");var t=i(n,r.options);return r.wrap(new r.Websocket(e,t.protocols,t.connection),t)},wrap:function(e,n){var u=i(n,r.options),c=s(o(e),u);p.apply(void 0,[c,u].concat(t(r.plugins))),c.onMessage(function(e){}),c.onClose(function(e,n){})}};return l.apply(void 0,[r].concat(t(r.plugins))),r},b=x;b.use=function(e){return c.push(e),d(b,e),b},b.configure=function(e){return a=i(e,a),b},b.websocket=function(e){return f=e,b},b.create=function(e,n){return x(f,n).create(e)},b.wrap=function(e,n){return x(f,n).wrap(e)},"undefined"!=typeof window&&(window.Rapport=b),"undefined"!=typeof n&&(n.exports=b)},{"./options.js":2,"./standardize.js":4,"./util.js":5,"./websocket/index.js":7}],2:[function(e,n,r){"use strict";var t=e("./util.js"),o={stringify:function(e){return t.isString(e)?e:e instanceof Error?JSON.stringify({name:e.name,message:e.message,stack:e.stack}):JSON.stringify(e)},parse:function(e){return t.isString(e)?JSON.parse(e):e},Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Date.now(),r=(n+16*Math.random())%16|0;return("x"===e?r:3&r|8).toString(16)})}};n.exports=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var t={},s=[].concat(n,[o]),i=0;i<s.length;i++)for(var u in s[i])s[i].hasOwnProperty(u)&&!t[u]&&(t[u]=s[i][u]);return t}},{"./util.js":5}],3:[function(e,n,r){"use strict";var t={},o={addCallback:function(e,n){t[e]={cb:n}},addPromise:function(e,n,r){t[e]={resolve:n,reject:r}},resolve:function(e,n){t[e]&&(t[e].cb?t[e].cb(n):t[e].resolve(n),delete t[e])},reject:function(e,n){t[e]&&(t[e].cb?t[e].cb(null,n):t[e].reject(n),delete t[e])},rejectAll:function(e){Object.keys(t).forEach(function(n){o.reject(n,e)})}};n.exports=o},{}],4:[function(e,n,r){"use strict";var t=function(e){return{onOpen:function(n){e.onopen=n},onClose:function(n){e.onclose=n},onError:function(n){e.onerror=n},onMessage:function(n){e.onmessage=function(e){n(e.data)}},send:e.send.bind(e),close:e.close.bind(e)}},o=function(e){function n(n,r){e.removeAllListeners(n),e.on(n,r)}return{onOpen:n.bind(null,"open"),onClose:n.bind(null,"close"),onError:n.bind(null,"error"),onMessage:n.bind(null,"message"),send:e.send.bind(e),close:e.close.bind(e)}};n.exports=function(e){return e.on?o(e):t(e)}},{}],5:[function(e,n,r){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o={isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e},isObject:function(e){return"object"===("undefined"==typeof e?"undefined":t(e))},isArray:function(e){return Array.isArray(e)},endsWith:function(e,n){return e.indexOf(n,e.length-n.length)!==-1},startsWith:function(e,n){return 0===e.lastIndexOf(n,0)},trimSlashes:function(e){var n=e;return o.endsWith(n,"/")&&(n=n.substring(0,n.length-1)),o.startsWith(n,"/")&&(n=n.substring(1,n.length)),n},forEach:function(e,n){for(var r in e)e.hasOwnProperty(r)&&n(r,e[r])}};n.exports=o},{}],6:[function(e,n,r){"use strict";var t=e("../request.cache.js");n.exports=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Socket was closed",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;t.rejectAll(new Error("Websocket was closed: with code "+o+" and message "+r)),e.close(o,n.stringify(r))}},{"../request.cache.js":3}],7:[function(e,n,r){"use strict";n.exports=function(n,r){var t={};return t.send=e("./send.js").bind(null,n,r),t.close=e("./close.js").bind(null,n,r),t.request=e("./request.js").bind(null,t,r),t.respond=e("./respond.js").bind(null,t,r),t.respondWithError=e("./respond.with.error.js").bind(null,t,r),t.onOpen=n.onOpen,t.onError=n.onError,t.onMessage=e("./on.message.js").bind(null,n,t,r),t.onClose=e("./on.close.js").bind(null,n,r),t}},{"./close.js":6,"./on.close.js":8,"./on.message.js":9,"./request.js":10,"./respond.js":11,"./respond.with.error.js":12,"./send.js":13}],8:[function(e,n,r){"use strict";var t=e("../request.cache.js");n.exports=function(e,n,r){e.onClose(function(e,o){var s=void 0;try{s=r.parse(o)}catch(e){s=o}t.rejectAll(new Error("Websocket was closed: with code "+e+" and message "+s)),n(s,e)})}},{"../request.cache.js":3}],9:[function(e,n,r){"use strict";var t=e("../request.cache.js"),o=function e(n,r,t,o){n.onMessage(function(n){var s=void 0;try{s=t.parse(n)}catch(e){return void r.send(e)}s.responseId?e.handleResponse(s.responseId,s.body,s.error):s.requestId?e.handleRequest(r,s.requestId,s.body,o):e.handleMessage(r,s,o)})};o.handleResponse=function(e,n,r){n?t.resolve(e,n):r?t.reject(e,r):t.reject(e,new Error("Got a response object without a response or error property"))},o.handleRequest=function(e,n,r,t){var o={id:n,isRequest:!0,body:r},s={sent:!1,respond:function(r){s.sent=!0,e.respond(n,r)},respondWithError:function(r){s.sent=!0,e.respondWithError(n,r)},send:e.send};t(o,s)},o.handleMessage=function(e,n,r){var t={isRequest:!1,body:n};r(t,e)},n.exports=o},{"../request.cache.js":3}],10:[function(e,n,r){"use strict";var t=e("../request.cache.js");n.exports=function(e,n,r,o,s){var i={requestId:n.generateRequestId(),body:r};if(o&&setTimeout(function(){t.reject(i.requestId,new Error("Timed out after "+o+" ms"))},o),!s){if(n.Promise)return new n.Promise(function(n,r){t.addPromise(i.requestId,n,r),e.send(i)});throw new Error("Can\t make a request without a Promise implementation or callback")}t.addCallback(i.requestId,s),e.send(i)}},{"../request.cache.js":3}],11:[function(e,n,r){"use strict";n.exports=function(e,n,r,t){e.send({responseId:r,body:t})}},{}],12:[function(e,n,r){"use strict";n.exports=function(e,n,r,t){e.send({responseId:r,error:t})}},{}],13:[function(e,n,r){"use strict";n.exports=function(e,n,r){e.send(n.stringify(r))}},{}]},{},[1]);
