!function e(t,n,r){function o(i,u){if(!n[i]){if(!t[i]){var a="function"==typeof require&&require;if(!u&&a)return a(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,function(e){var n=t[i][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[i].exports}for(var s="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){"use strict";var r=e("./standardize.js"),o=e("./websocket/index.js"),s=e("./options.js"),i=e("./util.js"),u=function(t,n){s.initialize(n);var u={Router:e("./router.js"),create:function(e,n){var r=void 0;return n&&i.isObject(n)&&(r=n.ws,delete n.ws),u.wrap(new t(e,r),n)},wrap:function(e,t){if(t&&t.router&&!i.isObject(t.router)&&!i.isFunction(t.router.handle))throw new Error("Please supply a rapport router as the router property");return o(r(e),t)}};return u};"undefined"!=typeof window&&(window.Rapport=u),"undefined"!=typeof t&&(t.exports=u)},{"./options.js":2,"./router.js":4,"./standardize.js":5,"./util.js":6,"./websocket/index.js":11}],2:[function(e,t,n){"use strict";var r={initialize:function(e){e&&(e.stringify&&(r.stringify=e.stringify),e.parse&&(r.parse=e.parse),e.Promise&&(r.Promise=e.Promise),e.generateRequestId&&(r.generateRequestId=e.generateRequestId))},stringify:function(e){return e instanceof Error?JSON.stringify({name:e.name,message:e.message,stack:e.stack}):JSON.stringify(e)},parse:JSON.parse,Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Date.now(),n=(t+16*Math.random())%16|0;return("x"===e?n:3&n|8).toString(16)})}};t.exports=r},{}],3:[function(e,t,n){"use strict";var r=e("./util.js"),o={},s={addCallback:function(e,t){o[e]={cb:t}},addPromise:function(e,t,n){o[e]={resolve:t,reject:n}},resolve:function(e,t){o[e]&&(o[e].cb?o[e].cb(t):o[e].resolve(t),delete o[e])},reject:function(e,t){o[e]&&(o[e].cb?o[e].cb(null,t):o[e].reject(t),delete o[e])},rejectAll:function(e,t){Object.keys(o).forEach(function(n){s.reject(n,new Error("Websocket has been closed: "+e+" - "+r.stringify(t)))})}};t.exports=s},{"./util.js":6}],4:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var o=e("path-to-regexp"),s=e("./util.js"),i=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=[];if(!n||0===n.length)throw new Error("Please supply at least one handler for the route");for(var i=0;i<n.length;i++){var u={method:e};if(!s.isFunction(n[i]))throw new Error("Please supply only handler functions to rapport route methods");u.handle=n[i],o.push(u)}return o},u=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].method]=!0;return t},a=function(e,t,n,r){var o=function o(){if(n.length>0){var i=n.shift();if("all"===i.method||i.method===e.method)try{var u=i.handle(e,t,o);u&&s.isFunction(u.then)&&u.then(o,r)}catch(e){r(e)}}};o()},c=function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];for(var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=0;s<t.length;s++)t[s]&&0!==t[s].length&&o.push.apply(o,r(t[s]));return o},l=function(e){var t=[];return o(e,t),0!==t.length},f=function(e,t){var n=s.trimSlashes(e),r=s.trimSlashes(t);return 0!==n.length&&0!==r.length?n+"/"+r:0===n.length?r:n},d=function(){var e={},t=[],n=[],r=[],d=function(r,i){var a=s.trimSlashes(r);if(l(r)){for(var f=0;f<t.length;f++)if(t[f].route===r)return c(t[f].chain,i),void(t[f].handledMethods=u(t[f].chain));var d=[],p=o(r,d),h=c([],n,i),g=u(h);t.push({route:r,keys:d,regex:p,handledMethods:g,chain:h})}else e[a]||(e[a]={chain:c([],n)}),c(e[a].chain,i),e[a].handledMethods=u(e[a].chain)},p=function(e){c(r,e)},h=function(r){c(n,r),s.forEach(e,function(e,t){c(t.chain,r),t.handledMethods=u(t.chain)});for(var o=0;o<t.length;o++)c(t[o].chain,r),t[o].handledMethods=u(t[o].chain)},g=function(e,t){s.forEach(t.getRoutes(),function(t,n){d(f(e,t),n.chain)});for(var n=t.getRegexRoutes(),r=0;r<n.length;r++)d(f(e,n[r].route),n[r].chain);p(t.getErrorHandlers())},v={getRoutes:function(){return e},getRegexRoutes:function(){return t},getErrorHandlers:function(){return r},use:function(e,t){if(s.isString(e)){if(!s.isFunction(t.getRoutes))throw new Error("Please supply a router as the second parameter in .use() for route "+e);g(e,t)}else if(s.isFunction(e.getRoutes))g("",t);else{if(!s.isFunction(e))throw new Error("Invalid first parameter "+e+" for router.use()");h(i("all",e))}},all:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,i.apply(void 0,["all"].concat(n)))},put:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,i.apply(void 0,["put"].concat(n)))},post:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,i.apply(void 0,["post"].concat(n)))},patch:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,i.apply(void 0,["patch"].concat(n)))},get:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,i.apply(void 0,["get"].concat(n)))},delete:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d(e,i.apply(void 0,["delete"].concat(n)))},error:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];p(i.apply(void 0,["all"].concat(t)))},handle:function(e,t){var n=s.trimSlashes(e.url),r=function(e){var n=c([],v.getErrorHandlers()),r=function(e){var n=500;s.isObject(e)&&e.status&&(n=e.status,delete e.status),t.status(n).send(e)};return 0===n.length?void r(e):void a(e,t,n,r)},o=function(){for(var o=v.getRegexRoutes(),s=[],i=0;i<o.length;i++){var u=o[i],l=n.match(u.regex);if(null!==l&&(l.shift(),u.handledMethods.all||u.handledMethods[e.method])){e.params={};for(var f=0;f<u.keys.length;f++)e.params[u.keys[f].name]=l[f];c(s,u.chain);break}}if(0===s.length){var d=new Error("Not Found");return d.status=404,void r(d)}a(e,t,s,r)},i=function(){var s=v.getRoutes()[n],i=s?c([],s.chain):[];return 0===i.length||!s.handledMethods.all&&!s.handledMethods[e.method]?void o():void a(e,t,i,r)};i()}};return v};t.exports=d},{"./util.js":6,"path-to-regexp":21}],5:[function(e,t,n){"use strict";var r=function(e){return{onOpen:function(t){e.onopen=t},onClose:function(t){e.onclose=t},onError:function(t){e.onerror=t},onMessage:function(t){e.onmessage=function(e){t(e.data)}},send:e.send.bind(e),close:e.close.bind(e)}},o=function(e){function t(t,n){e.removeAllListeners(t),e.on(t,n)}return{onOpen:t.bind(null,"open"),onClose:t.bind(null,"close"),onError:t.bind(null,"error"),onMessage:t.bind(null,"message"),send:e.send.bind(e),close:e.close.bind(e)}};t.exports=function(e){return e.on?o(e):r(e)}},{}],6:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./options.js"),s={stringify:function(e){return s.isString(e)?e:o.stringify(e)},parse:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(s.isString(e))try{return o.parse(e)}catch(e){if(null!==t)return t;throw e}return e},isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e},isObject:function(e){return"object"===("undefined"==typeof e?"undefined":r(e))},endsWith:function(e,t){return e.indexOf(t,e.length-t.length)!==-1},startsWith:function(e,t){return 0===e.lastIndexOf(t,0)},trimSlashes:function(e){var t=e;return s.endsWith(t,"/")&&(t=t.substring(0,t.length-1)),s.startsWith(t,"/")&&(t=t.substring(1,t.length)),t},forEach:function(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}};t.exports=s},{"./options.js":2}],7:[function(e,t,n){"use strict";var r=e("../util.js"),o=e("../request.cache.js");t.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Socket was closed locally",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;o.rejectAll(n,t),e.close(n,r.stringify(t))}},{"../request.cache.js":3,"../util.js":6}],8:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o){return e.http("delete",t,n,r,o)}},{}],9:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o){var s=t;if(n){var i=[];for(var u in n)n.hasOwnProperty(u)&&i.push(encodeURIComponent(u)+"="+encodeURIComponent(n[u]));s=t+"?"+i.join("&")}return e.http("get",s,void 0,r,o)}},{}],10:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o,s){return e.request({method:t,url:n,body:r},o,s)}},{}],11:[function(e,t,n){"use strict";t.exports=function(t,n){var r=n&&n.router?n.router:null,o={};return o.send=e("./send.js").bind(null,t),o.close=e("./close.js").bind(null,t),o.request=e("./request.js").bind(null,o),o.respond=e("./respond.js").bind(null,o),o.respondWithError=e("./respond.with.error.js").bind(null,o),o.http=e("./http.js").bind(null,o),o.get=e("./get.js").bind(null,o),o.post=e("./post.js").bind(null,o),o.put=e("./put.js").bind(null,o),o.patch=e("./patch.js").bind(null,o),o.delete=e("./delete.js").bind(null,o),o.onOpen=t.onOpen,o.onError=t.onError,o.onMessage=e("./on.message.js").bind(null,t,o,r),o.onClose=e("./on.close.js").bind(null,t),o.onMessage(function(e){}),o.onClose(function(e,t){}),o}},{"./close.js":7,"./delete.js":8,"./get.js":9,"./http.js":10,"./on.close.js":12,"./on.message.js":13,"./patch.js":14,"./post.js":15,"./put.js":16,"./request.js":17,"./respond.js":18,"./respond.with.error.js":19,"./send.js":20}],12:[function(e,t,n){"use strict";var r=e("../util.js"),o=e("../request.cache.js");t.exports=function(e,t){e.onClose(function(e,n){var s=r.parse(n,n);o.rejectAll(e,s),t(s,e)})}},{"../request.cache.js":3,"../util.js":6}],13:[function(e,t,n){"use strict";var r=e("../util.js"),o=e("../request.cache.js"),s=function(e,t,n){t?o.resolve(e,t):n?o.reject(e,n):o.reject(e,new Error("Got a response object without a response or error property"))},i=function(e,t,n,r){var o=r.url.indexOf("?")>=0,s=o?r.url.substr(0,r.url.indexOf("?")):r.url,i=o?r.url.substr(r.url.indexOf("?")+1).split("&"):[],u={};if(i&&i.length>0)for(var a=0;a<i.length;a++){var c=decodeURIComponent(i[a].substr(0,i[a].indexOf("=")));u[c]=decodeURIComponent(i[a].substr(i[a].indexOf("=")+1))}var l={id:n,method:r.method,body:r.body,url:s,query:u},f={_status:200,sent:!1,status:function(e){return f._status=e,f},respond:function(t){f.sent=!0,e.respond(n,t)},respondWithError:function(t){f.sent=!0,e.respondWithError(n,t)},send:function(e){var t={status:f._status,body:e};f._status>=200&&f._status<300?f.respond(t):f.respondWithError(t)}};t.handle(l,f)},u=function(e,t,n,r){var o={id:t,isRequest:!0,body:n},s={sent:!1,respond:function(n){s.sent=!0,e.respond(t,n)},respondWithError:function(n){s.sent=!0,e.respondWithError(t,n)},send:e.send};r(o,s)},a=function(e,t,n){var r={isRequest:!1,body:t};n(r,e)};t.exports=function(e,t,n,o){e.onMessage(function(e){var c=void 0;try{c=r.parse(e)}catch(e){return void t.send(e)}c.responseId?s(c.responseId,c.body,c.error):c.requestId?n&&c.body&&c.body.method&&c.body.url?i(t,n,c.requestId,c.body):u(t,c.requestId,c.body,o):a(t,c,o)})}},{"../request.cache.js":3,"../util.js":6}],14:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o){return e.http("patch",t,n,r,o)}},{}],15:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o){return e.http("post",t,n,r,o)}},{}],16:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o){return e.http("put",t,n,r,o)}},{}],17:[function(e,t,n){"use strict";var r=e("../options.js"),o=e("../request.cache.js");t.exports=function(e,t,n,s){var i={requestId:r.generateRequestId(),body:t};if(n&&setTimeout(function(){o.reject(i.requestId,new Error("Timed out after "+n+" ms"))},n),!s){if(r.Promise)return new r.Promise(function(t,n){o.addPromise(i.requestId,t,n),e.send(i)});throw new Error("Can\t make a request without a Promise implementation or callback")}o.addCallback(i.requestId,s),e.send(i)}},{"../options.js":2,"../request.cache.js":3}],18:[function(e,t,n){"use strict";t.exports=function(e,t,n){e.send({responseId:t,body:n})}},{}],19:[function(e,t,n){"use strict";t.exports=function(e,t,n){e.send({responseId:t,error:n})}},{}],20:[function(e,t,n){"use strict";var r=e("../util.js");t.exports=function(e,t){e.send(r.stringify(t))}},{"../util.js":6}],21:[function(e,t,n){function r(e,t){for(var n,r=[],o=0,s=0,i="",u=t&&t.delimiter||"/";null!=(n=x.exec(e));){var l=n[0],f=n[1],d=n.index;if(i+=e.slice(s,d),s=d+l.length,f)i+=f[1];else{var p=e[s],h=n[2],g=n[3],v=n[4],y=n[5],j=n[6],m=n[7];i&&(r.push(i),i="");var b=null!=h&&null!=p&&p!==h,w="+"===j||"*"===j,E="?"===j||"*"===j,R=n[2]||u,q=v||y;r.push({name:g||o++,prefix:h||"",delimiter:R,optional:E,repeat:w,partial:b,asterisk:!!m,pattern:q?c(q):m?".*":"[^"+a(R)+"]+?"})}}return s<e.length&&(i+=e.substr(s)),i&&r.push(i),r}function o(e,t){return u(r(e,t))}function s(e){return encodeURI(e).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function i(e){return encodeURI(e).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function u(e){for(var t=new Array(e.length),n=0;n<e.length;n++)"object"==typeof e[n]&&(t[n]=new RegExp("^(?:"+e[n].pattern+")$"));return function(n,r){for(var o="",u=n||{},a=r||{},c=a.pretty?s:encodeURIComponent,l=0;l<e.length;l++){var f=e[l];if("string"!=typeof f){var d,p=u[f.name];if(null==p){if(f.optional){f.partial&&(o+=f.prefix);continue}throw new TypeError('Expected "'+f.name+'" to be defined')}if(y(p)){if(!f.repeat)throw new TypeError('Expected "'+f.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(f.optional)continue;throw new TypeError('Expected "'+f.name+'" to not be empty')}for(var h=0;h<p.length;h++){if(d=c(p[h]),!t[l].test(d))throw new TypeError('Expected all "'+f.name+'" to match "'+f.pattern+'", but received `'+JSON.stringify(d)+"`");o+=(0===h?f.prefix:f.delimiter)+d}}else{if(d=f.asterisk?i(p):c(p),!t[l].test(d))throw new TypeError('Expected "'+f.name+'" to match "'+f.pattern+'", but received "'+d+'"');o+=f.prefix+d}}else o+=f}return o}}function a(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function c(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function l(e,t){return e.keys=t,e}function f(e){return e.sensitive?"":"i"}function d(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)t.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return l(e,t)}function p(e,t,n){for(var r=[],o=0;o<e.length;o++)r.push(v(e[o],t,n).source);var s=new RegExp("(?:"+r.join("|")+")",f(n));return l(s,t)}function h(e,t,n){return g(r(e,n),t,n)}function g(e,t,n){y(t)||(n=t||n,t=[]),n=n||{};for(var r=n.strict,o=n.end!==!1,s="",i=0;i<e.length;i++){var u=e[i];if("string"==typeof u)s+=a(u);else{var c=a(u.prefix),d="(?:"+u.pattern+")";t.push(u),u.repeat&&(d+="(?:"+c+d+")*"),d=u.optional?u.partial?c+"("+d+")?":"(?:"+c+"("+d+"))?":c+"("+d+")",s+=d}}var p=a(n.delimiter||"/"),h=s.slice(-p.length)===p;return r||(s=(h?s.slice(0,-p.length):s)+"(?:"+p+"(?=$))?"),s+=o?"$":r&&h?"":"(?="+p+"|$)",l(new RegExp("^"+s,f(n)),t)}function v(e,t,n){return y(t)||(n=t||n,t=[]),n=n||{},e instanceof RegExp?d(e,t):y(e)?p(e,t,n):h(e,t,n)}var y=e("isarray");t.exports=v,t.exports.parse=r,t.exports.compile=o,t.exports.tokensToFunction=u,t.exports.tokensToRegExp=g;var x=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g")},{isarray:22}],22:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}]},{},[1]);
