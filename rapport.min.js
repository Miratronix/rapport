!function t(e,r,n){function o(i,u){if(!r[i]){if(!e[i]){var c="function"==typeof require&&require;if(!u&&c)return c(i,!0);if(s)return s(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var l=r[i]={exports:{}};e[i][0].call(l.exports,function(t){var r=e[i][1][t];return o(r?r:t)},l,l.exports,t,e,r,n)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(t,e,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=t("./standardize.js"),s=t("./websocket/index.js"),i=t("./options.js"),u=function(e,r){i.initialize(r);var u={Router:t("./router.js"),create:function(t,r){var o=void 0;return r&&"object"===("undefined"==typeof r?"undefined":n(r))&&(o=r.ws,delete r.ws),u.wrap(new e(t,o),r)},wrap:function(t,e){if(e&&e.router&&"object"!==n(e.router)&&!e.router.dispatch)throw new Error("Please supply a rapport router as the router property");return s(o(t),e.router)}};return u};"undefined"!=typeof window&&(window.Rapport=u),"undefined"!=typeof e&&(e.exports=u)},{"./options.js":2,"./router.js":4,"./standardize.js":5,"./websocket/index.js":11}],2:[function(t,e,r){"use strict";var n={initialize:function(t){t&&(t.stringify&&(n.stringify=t.stringify),t.parse&&(n.parse=t.parse),t.Promise&&(n.Promise=t.Promise),t.generateRequestId&&(n.generateRequestId=t.generateRequestId))},stringify:JSON.stringify,parse:JSON.parse,Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Date.now(),r=(e+16*Math.random())%16|0;return("x"===t?r:3&r|8).toString(16)})}};e.exports=n},{}],3:[function(t,e,r){"use strict";var n=t("./util.js"),o={},s={addCallback:function(t,e){o[t]={cb:e}},addPromise:function(t,e,r){o[t]={resolve:e,reject:r}},resolve:function(t,e){o[t]&&(o[t].cb?o[t].cb(e):o[t].resolve(e),delete o[t])},reject:function(t,e){o[t]&&(o[t].cb?o[t].cb(null,e):o[t].reject(e),delete o[t])},rejectAll:function(t,e){Object.keys(o).forEach(function(r){s.reject(r,new Error("Websocket has been closed: "+t+" - "+n.stringify(e)))})}};e.exports=s},{"./util.js":6}],4:[function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}var o=t("./util.js"),s=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var s=[];if(!r||0===r.length)throw new Error("Please supply at least one handler for the route");for(var i=0;i<r.length;i++){var u={verb:t};if(!o.isFunction(r[i]))throw new Error("Please supply only handler methods to rapport route methods");u.dispatch=r[i],s.push(u)}return s},i=function(t,e,r,n){var s=!1,i=function i(){if(r.length>0){var u=r.shift();if("all"===u.verb||u.verb===t.verb)try{s=!0;var c=u.dispatch(t,e,i);c&&o.isFunction(c.then)&&c.then(i,n)}catch(t){n(t)}}else if(!s){var a=new Error("Not Found");a.status=404,n(a)}};i()},u=function(t){var e=t;return o.endsWith(e,"/")&&(e=e.substring(0,e.length-1)),o.startsWith(e,"/")&&(e=e.substring(1,e.length)),e},c=function(t,e){var r=u(t),n=u(e);return 0!==r.length&&0!==n.length?r+"/"+n:0===r.length?n:r},a=function(){for(var t=arguments.length,e=Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];for(var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=0;s<e.length;s++)e[s]&&0!==e[s].length&&o.push.apply(o,n(e[s]));return o},l=function(){var t={},e=[],r=function(e,r){var n=u(e);t[n]||(t[n]=[]),a(t[n],r)},n=function(t){a(e,t)},l={getRoutes:function(){return t},getErrorHandlers:function(){return e},use:function(e,i){if(o.isString(e))if(o.isFunction(i.getRoutes)){var u=i.getRoutes();for(var a in u)u.hasOwnProperty(a)&&r(c(e,a),u[a]);n(i.getErrorHandlers())}else o.isFunction(i)&&l.all(e,i);else if(o.isFunction(e.getRoutes))l.use("",i);else{if(!o.isFunction(e))throw new Error("Invalid first parameters "+e+" for router.use()");var f=s("all",e);for(var p in t)t.hasOwnProperty(p)&&r(e,f)}},all:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];r(t,s.apply(void 0,["all"].concat(n)))},put:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];r(t,s.apply(void 0,["put"].concat(n)))},post:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];r(t,s.apply(void 0,["post"].concat(n)))},patch:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];r(t,s.apply(void 0,["patch"].concat(n)))},get:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];r(t,s.apply(void 0,["get"].concat(n)))},delete:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];r(t,s.apply(void 0,["delete"].concat(n)))},error:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];n(s.apply(void 0,["all"].concat(e)))},dispatch:function(t,e){var r=u(t.route),n=l.getRoutes()[r],o=n?a([],n):[];i(t,e,o,function(t){l.dispatchError(t,e)})},dispatchError:function(t,e){var r=a([],l.getErrorHandlers());return 0===r.length?void e.status(t.status?t.status:500).send(t.message):void i(t,e,r,function(r){e.status(t.status?t.status:500).send(r.message)})}};return l};e.exports=l},{"./util.js":6}],5:[function(t,e,r){"use strict";var n=function(t){return{onOpen:function(e){t.onopen=e},onClose:function(e){t.onclose=e},onError:function(e){t.onerror=e},onMessage:function(e){t.onmessage=function(t){e(t.data)}},send:t.send.bind(t),close:t.close.bind(t)}},o=function(t){function e(e,r){t.removeAllListeners(e),t.on(e,r)}return{onOpen:e.bind(null,"open"),onClose:e.bind(null,"close"),onError:e.bind(null,"error"),onMessage:e.bind(null,"message"),send:t.send.bind(t),close:t.close.bind(t)}};e.exports=function(t){return t.on?o(t):n(t)}},{}],6:[function(t,e,r){"use strict";var n=t("./options.js"),o={stringify:function(t){return o.isString(t)?t:n.stringify(t)},parse:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(o.isString(t))try{return n.parse(t)}catch(t){if(e)return e;throw t}return t},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},endsWith:function(t,e){return t.indexOf(e,t.length-e.length)!==-1},startsWith:function(t,e){return 0===t.lastIndexOf(e,0)}};e.exports=o},{"./options.js":2}],7:[function(t,e,r){"use strict";var n=t("../util.js"),o=t("../request.cache.js");e.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Socket was closed locally",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;o.rejectAll(r,e),t.close(r,n.stringify(e))}},{"../request.cache.js":3,"../util.js":6}],8:[function(t,e,r){"use strict";e.exports=function(t,e,r,n,o){return t.http("delete",e,r,n,o)}},{}],9:[function(t,e,r){"use strict";e.exports=function(t,e,r,n,o){return t.http("get",e,r,n,o)}},{}],10:[function(t,e,r){"use strict";e.exports=function(t,e,r,n,o,s){return t.request({verb:e,route:r,body:n},o,s)}},{}],11:[function(t,e,r){"use strict";e.exports=function(e,r){var n=r&&r.router?r.router:null,o={};return o.send=t("./send.js").bind(null,e),o.close=t("./close.js").bind(null,e),o.request=t("./request.js").bind(null,o),o.respond=t("./respond.js").bind(null,o),o.respondWithError=t("./respond.with.error.js").bind(null,o),o.http=t("./http.js").bind(null,o),o.get=t("./get.js").bind(null,o),o.post=t("./post.js").bind(null,o),o.put=t("./put.js").bind(null,o),o.patch=t("./patch.js").bind(null,o),o.delete=t("./delete.js").bind(null,o),o.onOpen=e.onOpen,o.onError=e.onError,o.onMessage=t("./on.message.js").bind(null,e,o,n),o.onClose=t("./on.close.js").bind(null,e),o.onMessage(function(t){}),o.onClose(function(t,e){}),o}},{"./close.js":7,"./delete.js":8,"./get.js":9,"./http.js":10,"./on.close.js":12,"./on.message.js":13,"./patch.js":14,"./post.js":15,"./put.js":16,"./request.js":17,"./respond.js":18,"./respond.with.error.js":19,"./send.js":20}],12:[function(t,e,r){"use strict";var n=t("../util.js"),o=t("../request.cache.js");e.exports=function(t,e){t.onClose(function(t,r){var s=n.parse(r,r);o.rejectAll(t,s),e(s,t)})}},{"../request.cache.js":3,"../util.js":6}],13:[function(t,e,r){"use strict";var n=t("../util.js"),o=t("../request.cache.js"),s=function(t,e,r){e?o.resolve(t,e):r?o.reject(t,r):o.reject(t,new Error("Got a response object without a response or error property"))},i=function(t,e,r,n){var o={id:r,verb:n.verb,route:n.route,body:n},s={_status:200,sent:!1,status:function(t){return s._status=t,s},respond:function(e){s.sent=!0,t.respond(r,e)},respondWithError:function(e){s.sent=!0,t.respondWithError(r,e)},send:function(t){var e={status:s._status,body:t};s._status>=200&&s._status<300?s.respond(e):s.respondWithError(e)}};e.dispatch(o,s)},u=function(t,e,r,n){var o={id:e,isRequest:!0,body:r},s={sent:!1,respond:function(r){s.sent=!0,t.respond(e,r)},respondWithError:function(r){s.sent=!0,t.respondWithError(e,r)},send:t.send};n(o,s)},c=function(t,e,r){var n={isRequest:!1,body:e};r(n,t)};e.exports=function(t,e,r,o){t.onMessage(function(t){var a=void 0;try{a=n.parse(t)}catch(t){return void e.send(t)}a.responseId?s(a.responseId,a.response,a.error):a.requestId?r&&a.request&&a.request.verb&&a.request.route?i(e,r,a.requestId,a.request):u(e,a.requestId,a.request,o):c(e,a,o)})}},{"../request.cache.js":3,"../util.js":6}],14:[function(t,e,r){"use strict";e.exports=function(t,e,r,n,o){return t.http("patch",e,r,n,o)}},{}],15:[function(t,e,r){"use strict";e.exports=function(t,e,r,n,o){return t.http("post",e,r,n,o)}},{}],16:[function(t,e,r){"use strict";e.exports=function(t,e,r,n,o){return t.http("put",e,r,n,o)}},{}],17:[function(t,e,r){"use strict";var n=t("../options.js"),o=t("../request.cache.js");e.exports=function(t,e,r,s){var i={requestId:n.generateRequestId(),request:e};if(r&&setTimeout(function(){o.reject(i.requestId,new Error("Timed out after "+r+" ms"))},r),!s){if(n.Promise)return new n.Promise(function(e,r){o.addPromise(i.requestId,e,r),t.send(i)});throw new Error("Can\t make a request without a Promise implementation or callback")}o.addCallback(i.requestId,s),t.send(i)}},{"../options.js":2,"../request.cache.js":3}],18:[function(t,e,r){"use strict";e.exports=function(t,e,r){t.send({responseId:e,response:r})}},{}],19:[function(t,e,r){"use strict";e.exports=function(t,e,r){t.send({responseId:e,error:r})}},{}],20:[function(t,e,r){"use strict";var n=t("../util.js");e.exports=function(t,e){t.send(n.stringify(e))}},{"../util.js":6}]},{},[1]);
