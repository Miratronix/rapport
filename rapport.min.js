!function e(t,r,n){function o(i,u){if(!r[i]){if(!t[i]){var c="function"==typeof require&&require;if(!u&&c)return c(i,!0);if(s)return s(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var l=r[i]={exports:{}};t[i][0].call(l.exports,function(e){var r=t[i][1][e];return o(r?r:e)},l,l.exports,e,t,r,n)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./standardize.js"),s=e("./websocket/index.js"),i=e("./options.js"),u=function(t,r){i.initialize(r);var u={Router:e("./router.js"),create:function(e,r){var o=void 0;return r&&"object"===("undefined"==typeof r?"undefined":n(r))&&(o=r.ws,delete r.ws),u.wrap(new t(e,o),r)},wrap:function(e,t){if(t&&t.router&&"object"!==n(t.router)&&!t.router.dispatch)throw new Error("Please supply a rapport router as the router property");return s(o(e),t.router)}};return u};"undefined"!=typeof window&&(window.Rapport=u),"undefined"!=typeof t&&(t.exports=u)},{"./options.js":2,"./router.js":4,"./standardize.js":5,"./websocket/index.js":11}],2:[function(e,t,r){"use strict";var n={initialize:function(e){e&&(e.stringify&&(n.stringify=e.stringify),e.parse&&(n.parse=e.parse),e.Promise&&(n.Promise=e.Promise),e.generateRequestId&&(n.generateRequestId=e.generateRequestId))},stringify:JSON.stringify,parse:JSON.parse,Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Date.now(),r=(t+16*Math.random())%16|0;return("x"===e?r:3&r|8).toString(16)})}};t.exports=n},{}],3:[function(e,t,r){"use strict";var n=e("./util.js"),o={},s={addCallback:function(e,t){o[e]={cb:t}},addPromise:function(e,t,r){o[e]={resolve:t,reject:r}},resolve:function(e,t){o[e]&&(o[e].cb?o[e].cb(t):o[e].resolve(t),delete o[e])},reject:function(e,t){o[e]&&(o[e].cb?o[e].cb(null,t):o[e].reject(t),delete o[e])},rejectAll:function(e,t){Object.keys(o).forEach(function(r){s.reject(r,new Error("Websocket has been closed: "+e+" - "+n.stringify(t)))})}};t.exports=s},{"./util.js":6}],4:[function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var o=e("./util.js"),s=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var s=[];if(!r||0===r.length)throw new Error("Please supply at least one handler for the route");for(var i=0;i<r.length;i++){var u={verb:e};if(!o.isFunction(r[i]))throw new Error("Please supply only handler methods to rapport route methods");u.dispatch=r[i],s.push(u)}return s},i=function(e,t,r,n){var s=!1,i=function i(){if(r.length>0){var u=r.shift();if("all"===u.verb||u.verb===t.verb)try{s=!0;var c=u.dispatch(e,t,i);c&&o.isFunction(c.then)&&c.then(i,n)}catch(e){n(e)}}else s||n(new Error("Not Found"))};i()},u=function(e){var t=e;return o.endsWith(t,"/")&&(t=t.substring(0,t.length-1)),o.startsWith(t,"/")&&(t=t.substring(1,t.length)),t},c=function(e,t){var r=u(e),n=u(t);return 0!==r.length&&0!==n.length?r+"/"+n:0===r.length?n:r},a=function(){for(var e=arguments.length,t=Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];for(var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=0;s<t.length;s++)t[s]&&0!==t[s].length&&o.push.apply(o,n(t[s]));return o},l=function(){var e={},t=[],r=function(t,r){var n=u(t);e[n]||(e[n]=[]),a(e[n],r)},n=function(e){a(t,e)},l={getRoutes:function(){return e},getErrorHandlers:function(){return t},use:function(t,i){if(o.isString(t))if(o.isFunction(i.getRoutes)){var u=i.getRoutes();for(var a in u)u.hasOwnProperty(a)&&r(c(t,a),u[a]);n(i.getErrorHandlers())}else o.isFunction(i)&&l.all(t,i);else if(o.isFunction(t.getRoutes))l.use("",i);else{if(!o.isFunction(t))throw new Error("Invalid first parameters "+t+" for router.use()");var f=s("all",t);for(var p in e)e.hasOwnProperty(p)&&r(t,f)}},all:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];r(e,s.apply(void 0,["all"].concat(n)))},put:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];r(e,s.apply(void 0,["put"].concat(n)))},post:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];r(e,s.apply(void 0,["post"].concat(n)))},patch:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];r(e,s.apply(void 0,["patch"].concat(n)))},get:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];r(e,s.apply(void 0,["get"].concat(n)))},delete:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];r(e,s.apply(void 0,["delete"].concat(n)))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n(s.apply(void 0,["all"].concat(t)))},dispatch:function(e,t){var r=u(t.route),n=l.getRoutes()[r],o=n?a([],n):[];i(e,t,o,function(e){l.dispatchError(e,t)})},dispatchError:function(e,t){var r=a([],l.getErrorHandlers());return 0===r.length?void t.respondWithError(e):void i(e,t,r,function(e){t.respondWithError(e)})}};return l};t.exports=l},{"./util.js":6}],5:[function(e,t,r){"use strict";var n=function(e){return{onOpen:function(t){e.onopen=t},onClose:function(t){e.onclose=t},onError:function(t){e.onerror=t},onMessage:function(t){e.onmessage=function(e){t(e.data)}},send:e.send.bind(e),close:e.close.bind(e)}},o=function(e){function t(t,r){e.removeAllListeners(t),e.on(t,r)}return{onOpen:t.bind(null,"open"),onClose:t.bind(null,"close"),onError:t.bind(null,"error"),onMessage:t.bind(null,"message"),send:e.send.bind(e),close:e.close.bind(e)}};t.exports=function(e){return e.on?o(e):n(e)}},{}],6:[function(e,t,r){"use strict";var n=e("./options.js"),o={stringify:function(e){return o.isString(e)?e:n.stringify(e)},parse:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(o.isString(e))try{return n.parse(e)}catch(e){if(t)return t;throw e}return e},isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e},endsWith:function(e,t){return e.indexOf(t,e.length-t.length)!==-1},startsWith:function(e,t){return 0===e.lastIndexOf(t,0)}};t.exports=o},{"./options.js":2}],7:[function(e,t,r){"use strict";var n=e("../util.js"),o=e("../request.cache.js");t.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Socket was closed locally",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;o.rejectAll(r,t),e.close(r,n.stringify(t))}},{"../request.cache.js":3,"../util.js":6}],8:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o){return e.http("delete",t,r,n,o)}},{}],9:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o){return e.http("get",t,r,n,o)}},{}],10:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o,s){return e.request({verb:t,route:r,body:n},o,s)}},{}],11:[function(e,t,r){"use strict";t.exports=function(t,r){var n=r&&r.router?r.router:null,o={};return o.send=e("./send.js").bind(null,t),o.close=e("./close.js").bind(null,t),o.request=e("./request.js").bind(null,o),o.respond=e("./respond.js").bind(null,o),o.respondWithError=e("./respond.with.error.js").bind(null,o),o.http=e("./http.js").bind(null,o),o.get=e("./get.js").bind(null,o),o.post=e("./post.js").bind(null,o),o.put=e("./put.js").bind(null,o),o.patch=e("./patch.js").bind(null,o),o.delete=e("./delete.js").bind(null,o),o.onOpen=t.onOpen,o.onError=t.onError,o.onMessage=e("./on.message.js").bind(null,t,o,n),o.onClose=e("./on.close.js").bind(null,t),o.onMessage(function(e){}),o.onClose(function(e,t){}),o}},{"./close.js":7,"./delete.js":8,"./get.js":9,"./http.js":10,"./on.close.js":12,"./on.message.js":13,"./patch.js":14,"./post.js":15,"./put.js":16,"./request.js":17,"./respond.js":18,"./respond.with.error.js":19,"./send.js":20}],12:[function(e,t,r){"use strict";var n=e("../util.js"),o=e("../request.cache.js");t.exports=function(e,t){e.onClose(function(e,r){var s=n.parse(r,r);o.rejectAll(e,s),t(s,e)})}},{"../request.cache.js":3,"../util.js":6}],13:[function(e,t,r){"use strict";var n=e("../util.js"),o=e("../request.cache.js"),s=function(e,t,r){t?o.resolve(e,t):r?o.reject(e,r):o.reject(e,new Error("Got a response object without a response or error property"))},i=function(e,t,r,n,o){var s={requestId:r,shouldRespond:!0,hasResponded:!1,respond:function(t){s.hasResponded=!0,e.respond(r,t)},respondWithError:function(t){s.hasResponded=!0,e.respondWithError(r,t)},send:e.send};t&&n.verb&&n.route?(s.verb=n.verb,s.route=n.route,t.dispatch(n.body,s)):o(n,s)},u=function(e,t,r){r(t,{shouldRespond:!1,send:e.send})};t.exports=function(e,t,r,o){e.onMessage(function(e){var c=void 0;try{c=n.parse(e)}catch(e){return void t.send(e)}c.responseId?s(c.responseId,c.response,c.error):c.requestId?i(t,r,c.requestId,c.request,o):u(t,c,o)})}},{"../request.cache.js":3,"../util.js":6}],14:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o){return e.http("patch",t,r,n,o)}},{}],15:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o){return e.http("post",t,r,n,o)}},{}],16:[function(e,t,r){"use strict";t.exports=function(e,t,r,n,o){return e.http("put",t,r,n,o)}},{}],17:[function(e,t,r){"use strict";var n=e("../options.js"),o=e("../request.cache.js");t.exports=function(e,t,r,s){var i={requestId:n.generateRequestId(),request:t};if(r&&setTimeout(function(){o.reject(i.requestId,new Error("Timed out after "+r+" ms"))},r),!s){if(n.Promise)return new n.Promise(function(t,r){o.addPromise(i.requestId,t,r),e.send(i)});throw new Error("Can\t make a request without a Promise implementation or callback")}o.addCallback(i.requestId,s),e.send(i)}},{"../options.js":2,"../request.cache.js":3}],18:[function(e,t,r){"use strict";t.exports=function(e,t,r){e.send({responseId:t,response:r})}},{}],19:[function(e,t,r){"use strict";t.exports=function(e,t,r){e.send({responseId:t,error:r})}},{}],20:[function(e,t,r){"use strict";var n=e("../util.js");t.exports=function(e,t){e.send(n.stringify(t))}},{"../util.js":6}]},{},[1]);
