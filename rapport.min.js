!function e(n,r,s){function t(i,u){if(!r[i]){if(!n[i]){var c="function"==typeof require&&require;if(!u&&c)return c(i,!0);if(o)return o(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var a=r[i]={exports:{}};n[i][0].call(a.exports,function(e){var r=n[i][1][e];return t(r?r:e)},a,a.exports,e,n,r,s)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<s.length;i++)t(s[i]);return t}({1:[function(e,module,n){"use strict";var r=e("./standardize.js"),s=e("./websocket/index.js"),t=e("./options.js"),o=function(e,n){t.initialize(n);var o={create:function(n,r){return o.wrap(new e(n,r))},wrap:function(e){var n=s(r(e));return n.onMessage(function(e){}),n.onClose(function(e,n){}),n}};return o};"undefined"!=typeof window&&(window.Rapport=o),"undefined"!=typeof module&&(module.exports=o)},{"./options.js":2,"./standardize.js":4,"./websocket/index.js":7}],2:[function(e,module,n){"use strict";var r={initialize:function(e){e.stringify&&(r.stringify=e.stringify),e.parse&&(r.parse=e.parse),e.Promise&&(r.Promise=e.Promise),e.generateRequestId&&(r.generateRequestId=e.generateRequestId)},stringify:JSON.stringify,parse:JSON.parse,Promise:"undefined"!=typeof Promise?Promise:null,generateRequestId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Date.now(),r=(n+16*Math.random())%16|0;return("x"===e?r:3&r|8).toString(16)})}};module.exports=r},{}],3:[function(e,module,n){"use strict";var r=e("./util.js"),s={},t={addCallback:function(e,n){s[e]={cb:n}},addPromise:function(e,n,r){s[e]={resolve:n,reject:r}},resolve:function(e,n){s[e]&&(s[e].cb?s[e].cb(n):s[e].resolve(n),delete s[e])},reject:function(e,n){s[e]&&(s[e].cb?s[e].cb(null,n):s[e].reject(n),delete s[e])},rejectAll:function(e,n){Object.keys(s).forEach(function(s){t.reject(s,new Error("Websocket has been closed: "+e+" - "+r.stringify(n)))})}};module.exports=t},{"./util.js":5}],4:[function(e,module,n){"use strict";var r=function(e){return{onOpen:function(n){e.onopen=n},onClose:function(n){e.onclose=n},onError:function(n){e.onerror=n},onMessage:function(n){e.onmessage=function(e){n(e.data)}},send:e.send.bind(e),close:e.close.bind(e)}},s=function(e){function n(n,r){e.removeAllListeners(n),e.on(n,r)}return{onOpen:n.bind(null,"open"),onClose:n.bind(null,"close"),onError:n.bind(null,"error"),onMessage:n.bind(null,"message"),send:e.send.bind(e),close:e.close.bind(e)}};module.exports=function(e){return e.on?s(e):r(e)}},{}],5:[function(e,module,n){"use strict";var r=e("./options.js"),s={stringify:function(e){return"string"==typeof e?e:r.stringify(e)},parse:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("string"==typeof e)try{return r.parse(e)}catch(e){if(n)return n;throw e}return e}};module.exports=s},{"./options.js":2}],6:[function(e,module,n){"use strict";var r=e("../util.js"),s=e("../request.cache.js");module.exports=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Socket was closed locally";s.rejectAll(n,t),e.close(n,r.stringify(t))}},{"../request.cache.js":3,"../util.js":5}],7:[function(e,module,n){"use strict";module.exports=function(n){var r={};return r.send=e("./send.js").bind(null,n),r.close=e("./close.js").bind(null,n),r.request=e("./request.js").bind(null,r),r.respond=e("./respond.js").bind(null,r),r.respondWithError=e("./respond.with.error.js").bind(null,r),r.onOpen=n.onOpen,r.onError=n.onError,r.onMessage=e("./on.message.js").bind(null,n,r),r.onClose=e("./on.close.js").bind(null,n),r}},{"./close.js":6,"./on.close.js":8,"./on.message.js":9,"./request.js":10,"./respond.js":11,"./respond.with.error.js":12,"./send.js":13}],8:[function(e,module,n){"use strict";var r=e("../util.js"),s=e("../request.cache.js");module.exports=function(e,n){e.onClose(function(e,t){var o=r.parse(t,t);s.rejectAll(e,o),n(e,o)})}},{"../request.cache.js":3,"../util.js":5}],9:[function(e,module,n){"use strict";var r=e("../util.js"),s=e("../request.cache.js"),t=function(e,n,r){n?s.resolve(e,n):r?s.reject(e,r):s.reject(e,new Error("Got a response object without a response or error property"))},o=function(e,n,r,s){s(r,{requestId:n,shouldRespond:!0,respond:e.respond.bind(null,n),respondWithError:e.respondWithError.bind(null,n),send:e.send})},i=function(e,n,r){r(n,{shouldRespond:!1,send:e.send})};module.exports=function(e,n,s){e.onMessage(function(e){var u=void 0;try{u=r.parse(e)}catch(e){return void n.send(e)}u.responseId?t(u.responseId,u.response,u.error):u.requestId?o(n,u.requestId,u.request,s):i(n,u,s)})}},{"../request.cache.js":3,"../util.js":5}],10:[function(e,module,n){"use strict";var r=e("../options.js"),s=e("../request.cache.js");module.exports=function(e,n,t,o){var i={requestId:r.generateRequestId(),request:n};if(t&&setTimeout(function(){s.reject(i.requestId,new Error("Timed out after "+t+" ms"))},t),!o){if(r.Promise)return new r.Promise(function(n,r){s.addPromise(i.requestId,n,r),e.send(i)});throw new Error("Can\t make a request without a Promise implementation or callback")}s.addCallback(i.requestId,o),e.send(i)}},{"../options.js":2,"../request.cache.js":3}],11:[function(e,module,n){"use strict";module.exports=function(e,n,r){e.send({responseId:n,response:r})}},{}],12:[function(e,module,n){"use strict";module.exports=function(e,n,r){e.send({responseId:n,error:r})}},{}],13:[function(e,module,n){"use strict";var r=e("../util.js");module.exports=function(e,n){e.send(r.stringify(n))}},{"../util.js":5}]},{},[1]);
